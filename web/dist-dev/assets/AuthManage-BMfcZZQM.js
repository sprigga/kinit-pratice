var x=(p,C,m)=>new Promise((f,g)=>{var r=i=>{try{_(m.next(i))}catch(h){g(h)}},v=i=>{try{_(m.throw(i))}catch(h){g(h)}},_=i=>i.done?f(i.value):Promise.resolve(i.value).then(r,v);_((m=m.apply(p,C)).next())});import{I as H,A as U,_ as z}from"./index-BsUFl8WW.js";import{u as J}from"./dict-ttqq3e93.js";import{c as P}from"./menu-ScLc8rSZ.js";import{c as q}from"./dept-HqlzFmDD.js";import{e as S}from"./tree-Db49nok3.js";import{p as F}from"./role-bi8R3G-4.js";import{a8 as B,a9 as W,r as T,aa as X,u as G,v as Q,ab as A,ac as Y,ad as Z,b as I}from"./element-plus-BDQDiIak.js";import{l as $,a as c,b as ee,ah as ae,m as k,p as O,O as n,R as u,u as e,q as l,W as te,V as se,P as le,a7 as oe,S as ne,X as re,aH as ie,aI as de,n as M}from"./vue-chunks-DM5Q6aJS.js";import"./dict-Dgnb-fjD.js";const V=p=>(ie("data-v-67c37d81"),p=p(),de(),p),ce={class:"auth-manage-main-view"},ue={class:"flex justify-between pt-[20px] pb-[20px]"},pe=V(()=>l("span",null,"權限管理",-1)),fe={class:"h-12 flex justify-between mt-3 mr-3 ml-5"},me={class:"mt-1 text-[#909399]"},ve={class:"border-r-1 border-r-[#f0f0f0] b-r-solid h-[100%] p-[20px] box-border"},_e=V(()=>l("div",{class:"flex items-center"},[l("div",{class:"yxt-divider"}),l("span",null,"數據權限")],-1)),he={class:"ml-4 mt-3"},be={key:0,class:"mt-3 max-h-[65vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto"},ye=V(()=>l("div",{class:"flex items-center"},[l("div",{class:"yxt-divider"}),l("span",null,"選單權限")],-1)),xe={class:"mt-5 max-h-[70vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto box-border"},ge=$({__name:"AuthManage",props:{currentRow:{type:Object,default:()=>null}},emits:["getList"],setup(p,{expose:C,emit:m}){const f=p,g=m,r=c({});ee(()=>f.currentRow,t=>{t&&(r.value=JSON.parse(JSON.stringify(t)))},{deep:!0,immediate:!0});const v=c(!1),_=c(),i=()=>x(this,null,function*(){const a=yield J().getDictObj(["sys_vadmin_data_range"]);_.value=a.sys_vadmin_data_range}),h={children:"children",label:"label"};let E=c([]);const w=c(),N=()=>x(this,null,function*(){var a;const t=yield q();if(t&&(E.value=t.data,yield M(),f.currentRow)){const d=f.currentRow.depts.map(o=>o.id),s=[];S(t.data,o=>{d.includes(o.value)&&s.push(o.value)});for(const o of s)(a=e(w))==null||a.setChecked(o,!0,!1)}});let D=c([]);const b=c(),K=()=>x(this,null,function*(){var a;const t=yield P();if(t&&(D.value=t.data,yield M(),f.currentRow)){const d=f.currentRow.menus.map(o=>o.id),s=[];S(t.data,o=>{d.includes(o.value)&&s.push(o.value)});for(const o of s)(a=e(b))==null||a.setChecked(o,!0,!1)}}),y=c(!1),j=()=>x(this,null,function*(){var a,d,s;if(y.value)return;if(U(r.value.data_range)){I.error("數據範圍選擇項不能為空！");return}y.value=!0;const t=[...((a=e(b))==null?void 0:a.getCheckedKeys())||[],...((d=e(b))==null?void 0:d.getHalfCheckedKeys())||[]];r.value.menu_ids=t,r.value.dept_ids=(s=e(w))==null?void 0:s.getCheckedKeys();try{(yield F(r.value))&&(y.value=!1,I.success("保存成功"),R(),g("getList"))}finally{y.value=!1}}),L=()=>{v.value=!0,K(),N()},R=()=>{var t,a;v.value=!1,r.value={},(t=e(b))==null||t.setCheckedKeys([]),(a=e(w))==null||a.setCheckedKeys([])};return i(),C({openDrawer:L}),(t,a)=>{const d=ae("BaseButton");return k(),O("div",ce,[n(e(Z),{modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=s=>v.value=s),"with-header":!1,size:1e3,"before-close":R},{default:u(()=>[n(e(B),null,{default:u(()=>[n(e(W),null,{default:u(()=>[l("div",ue,[pe,l("span",{onClick:R,class:"flex cursor-pointer"},[n(e(H),{icon:"iconamoon:close-thin",size:23})])])]),_:1}),n(e(T)),l("div",fe,[l("div",me,[l("span",null,"角色名稱："+te(r.value.name),1)]),n(d,{type:"primary",loading:y.value,onClick:j},{default:u(()=>[se("保存")]),_:1},8,["loading"])]),n(e(T)),n(e(B),null,{default:u(()=>[n(e(X),{width:"450px"},{default:u(()=>[l("div",ve,[l("div",null,[_e,l("div",he,[n(e(G),{modelValue:r.value.data_range,"onUpdate:modelValue":a[0]||(a[0]=s=>r.value.data_range=s),placeholder:"請選擇數據範圍"},{default:u(()=>[(k(!0),O(le,null,oe(_.value,s=>(k(),ne(e(Q),{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r.value.data_range==="3"?(k(),O("div",be,[n(e(A),{ref_key:"deptTreeRef",ref:w,data:e(E),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!0},null,8,["data"])])):re("",!0)])])])]),_:1}),n(e(Y),null,{default:u(()=>[ye,l("div",xe,[n(e(A),{ref_key:"menuTreeRef",ref:b,data:e(D),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!1},null,8,["data"])])]),_:1})]),_:1})]),_:1}),n(e(T))]),_:1},8,["modelValue"])])}}}),Be=z(ge,[["__scopeId","data-v-67c37d81"]]);export{Be as default};
//# sourceMappingURL=AuthManage-BMfcZZQM.js.map
