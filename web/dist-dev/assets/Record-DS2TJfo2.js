var Z=Object.defineProperty;var T=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var B=(s,i,l)=>i in s?Z(s,i,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[i]=l,F=(s,i)=>{for(var l in i||(i={}))ee.call(i,l)&&B(s,l,i[l]);if(T)for(var l of T(i))te.call(i,l)&&B(s,l,i[l]);return s};var f=(s,i,l)=>new Promise((h,b)=>{var P=u=>{try{w(l.next(u))}catch(c){b(c)}},D=u=>{try{w(l.throw(u))}catch(c){b(c)}},w=u=>u.done?h(u.value):Promise.resolve(u.value).then(P,D);w((l=l.apply(s,i)).next())});import{r as g,d as ae,q as v}from"./index-BsUFl8WW.js";import{u as se,_ as re}from"./Table.vue_vue_type_script_lang-R3v9WsBF.js";import{_ as le}from"./Search.vue_vue_type_script_setup_true_lang-D2iD-Cem.js";import{_ as ie}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BH7Lshxr.js";import{_ as oe}from"./Write.vue_vue_type_script_setup_true_lang-ki5rIgB6.js";import{_ as ne}from"./Dialog.vue_vue_type_style_index_0_lang-BxUn_kyz.js";import{u as ue}from"./dict-ttqq3e93.js";import{s as de}from"./dict-DLPs-mJD.js";import{A as ce,m as pe,g as me}from"./element-plus-BDQDiIak.js";import{l as fe,a as n,J as U,O as r,u as a,P as R,_ as k,ar as C,V as _,m as q,p as ve,R as d,B as N,S as _e,W as j}from"./vue-chunks-DM5Q6aJS.js";import"./useForm-BPE0GJRY.js";import"./style.css_vue_type_style_index_0_src_true_lang-jwozmq-F.js";import"./wang-editor-CLgHiBvf.js";import"./_Uint8Array-DKqHwQen.js";import"./useIcon-CGEWj5sB.js";import"./useValidator-s_gjQ478.js";import"./dict-Dgnb-fjD.js";const we=s=>g.get({url:"/crm/visit/record",params:s}),ge=s=>g.post({url:"/crm/visit/record",data:s}),he=s=>g.delete({url:"/crm/visit/record",data:s}),be=s=>g.put({url:`/crm/visit/record/${s.id}`,data:s}),ye=s=>g.get({url:`crm/visit/record/${s}`}),qe=fe({name:"CrmVisitRecord",__name:"Record",setup(s){const{t:i}=ae(),{tableRegister:l,tableState:h,tableMethods:b}=se({fetchDataApi:()=>f(this,null,function*(){const{pageSize:t,currentPage:e}=h,o=yield we(F({page:a(e),limit:a(t)},a($)));return{list:o.data||[],total:o.count||0}}),fetchDelApi:t=>f(this,null,function*(){return(yield he(t)).code===200})}),{dataList:P,loading:D,total:w,pageSize:u,currentPage:c}=h,{getList:y,delList:J}=b,M=n([]),O=n([]),W=n([]);f(this,null,function*(){const e=yield ue().getDictObj(["sys_vadmin_platform","crm_record_issue_type","crm_record_assigned_user"]);M.value=e.sys_vadmin_platform,O.value=e.crm_record_issue_type,W.value=e.crm_record_assigned_user});const G=U([{field:"name",label:"業務姓名",width:"100px",show:!0,disabled:!0},{field:"customer_type",label:"拜訪店類型",width:"120px",show:!0,disabled:!0},{field:"customer_name",label:"客戶名稱",width:"150px",show:!0,disabled:!0},{field:"visit_period",label:"拜訪時間",width:"180px",show:!0,disabled:!0},{field:"purpose",label:"拜訪目的",width:"150px",show:!0,disabled:!0},{field:"content",label:"拜訪內容",width:"300px",show:!0,showOverflowTooltip:!1,slots:{default:({row:t})=>r("div",{style:"white-space: normal; word-break: break-word; line-height: 1.5; font-size: 14px;"},[t.content])}},{field:"issue_type",label:"問題類型",show:!1,slots:{default:t=>{const e=t.row;return r(R,null,[r("div",null,[de(a(O),e.issue_type)])])}}},{field:"assigned_user",label:"指派人員",width:"100px",show:!0,disabled:!0},{field:"visit_period",label:"預計回覆日期",width:"180px",show:!0,disabled:!0},{field:"is_closed",label:"是否結案",show:!0,slots:{default:t=>{const e=t.row;return r(R,null,[r(ce,{modelValue:e.is_closed,disabled:!0},null)])}}},{field:"action",label:"操作",width:"200px",show:!0,slots:{default:t=>{const e=t.row,o=["crm.visit.record.update"],p=["crm.visit.record.delete"];return r(R,null,[k(r(v,{type:"primary",link:!0,size:"small",onClick:()=>I(e)},{default:()=>[_("回覆")]}),[[C("hasPermi"),o]]),k(r(v,{type:"primary",link:!0,size:"small",onClick:()=>I(e)},{default:()=>[_("編輯")]}),[[C("hasPermi"),o]]),k(r(v,{type:"danger",loading:V.value,link:!0,size:"small",onClick:()=>K(e)},{default:()=>[_("删除")]}),[[C("hasPermi"),p]])])}}}]),H=U([{field:"name",label:"業務姓名",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"visit_type",label:"拜訪店類型",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"purpose",label:"拜訪目的",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"create_datetime",label:"建立時間",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}}]),$=n({}),L=t=>{c.value=1,$.value=t,y()},V=n(!1),K=t=>f(this,null,function*(){V.value=!0,yield J(!0,[t.id]).finally(()=>{V.value=!1})}),m=n(!1),S=n(""),A=n(),x=n(""),E=n(),z=n(!1),I=t=>f(this,null,function*(){const e=yield ye(t.id);e&&(S.value="編輯資料",x.value="edit",A.value=e.data,m.value=!0)}),Q=()=>{S.value="新增資料",x.value="add",A.value=void 0,m.value=!0},X=["crm.visit.record.create"],Y=()=>f(this,null,function*(){const t=a(E),e=yield t==null?void 0:t.submit();if(e){z.value=!0;try{const o=n({});x.value==="add"?(o.value=yield ge(e),o.value&&(m.value=!1,y())):x.value==="edit"&&(o.value=yield be(e),o.value&&(m.value=!1,y()))}finally{z.value=!1}}});return(t,e)=>{const o=C("hasPermi");return q(),ve(R,null,[r(a(ie),null,{default:d(()=>[r(a(le),{schema:H,onReset:L,onSearch:L},null,8,["schema"]),r(a(re),{"current-page":a(c),"onUpdate:currentPage":e[0]||(e[0]=p=>N(c)?c.value=p:null),"page-size":a(u),"onUpdate:pageSize":e[1]||(e[1]=p=>N(u)?u.value=p:null),showAction:"",columns:G,"default-expand-all":"","table-layout":"auto","node-key":"id",data:a(P),loading:a(D),pagination:{total:a(w)},onRegister:a(l),onRefresh:a(y)},{toolbar:d(()=>[r(a(pe),{gutter:10},{default:d(()=>[r(a(me),{span:1.5},{default:d(()=>[k((q(),_e(a(v),{type:"primary",onClick:Q},{default:d(()=>[_("新增資料")]),_:1})),[[o,{add:X}]])]),_:1})]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),r(a(ne),{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=p=>m.value=p),title:S.value,height:650},{footer:d(()=>[r(a(v),{type:"primary",loading:z.value,onClick:Y},{default:d(()=>[_(j(a(i)("exampleDemo.save")),1)]),_:1},8,["loading"]),r(a(v),{onClick:e[2]||(e[2]=p=>m.value=!1)},{default:d(()=>[_(j(a(i)("dialogDemo.close")),1)]),_:1})]),default:d(()=>[r(oe,{ref_key:"writeRef",ref:E,"current-row":A.value},null,8,["current-row"])]),_:1},8,["modelValue","title"])],64)}}});export{qe as default};
//# sourceMappingURL=Record-DS2TJfo2.js.map
