{"version":3,"file":"Record-DS2TJfo2.js","sources":["../../src/api/crm/visit/record.ts","../../src/views/Crm/Visit/Record/Record.vue"],"sourcesContent":["import request from '@/config/axios'\n\n/** 获取 日報管理 列表 */\nexport const getCrmVisitRecordListApi = (params: any): Promise<IResponse> => {\n  return request.get({ url: '/crm/visit/record', params })\n}\n\n/** 创建 日報管理 */\nexport const addCrmVisitRecordApi = (data: any): Promise<IResponse> => {\n  return request.post({ url: '/crm/visit/record', data })\n}\n\n/** 删除 日報管理 */\nexport const delCrmVisitRecordApi = (data: any): Promise<IResponse> => {\n  return request.delete({ url: '/crm/visit/record', data })\n}\n\n/** 更新 日報管理 */\nexport const putCrmVisitRecordApi = (data: any): Promise<IResponse> => {\n  return request.put({ url: `/crm/visit/record/${data.id}`, data })\n}\n\n/** 获取单个 日報管理 详情 */\nexport const getCrmVisitRecordApi = (dataId: number): Promise<IResponse> => {\n  return request.get({ url: `crm/visit/record/${dataId}` })\n}\n","<script setup lang=\"tsx\">\nimport { reactive, ref, unref } from 'vue'\nimport {\n  getCrmVisitRecordListApi,\n  addCrmVisitRecordApi,\n  delCrmVisitRecordApi,\n  putCrmVisitRecordApi,\n  getCrmVisitRecordApi\n} from '@/api/crm/visit/record'\n\nimport { useTable } from '@/hooks/web/useTable'\nimport { useI18n } from '@/hooks/web/useI18n'\nimport { Table, TableColumn } from '@/components/Table'\nimport { ElRow, ElCol, ElSwitch } from 'element-plus'\nimport { Search } from '@/components/Search'\nimport { FormSchema } from '@/components/Form'\nimport { ContentWrap } from '@/components/ContentWrap'\nimport Write from './components/Write.vue'\nimport { Dialog } from '@/components/Dialog'\nimport { useDictStore } from '@/store/modules/dict'\nimport { DictDetail, selectDictLabel } from '@/utils/dict'\nimport { BaseButton } from '@/components/Button'\n\ndefineOptions({\n  name: 'CrmVisitRecord'\n})\n\nconst { t } = useI18n()\n\nconst { tableRegister, tableState, tableMethods } = useTable({\n  fetchDataApi: async () => {\n    const { pageSize, currentPage } = tableState\n    const res = await getCrmVisitRecordListApi({\n      page: unref(currentPage),\n      limit: unref(pageSize),\n      ...unref(searchParams)\n    })\n    return {\n      list: res.data || [],\n      total: res.count || 0\n    }\n  },\n  fetchDelApi: async (value) => {\n    const res = await delCrmVisitRecordApi(value)\n    return res.code === 200\n  }\n})\n\nconst { dataList, loading, total, pageSize, currentPage } = tableState\nconst { getList, delList } = tableMethods\n\nconst platformOptions = ref<DictDetail[]>([])\nconst issue_typeOptions = ref<DictDetail[]>([])\nconst assigned_userOptions = ref<DictDetail[]>([])\n\nconst getOptions = async () => {\n  const dictStore = useDictStore()\n  const dictOptions = await dictStore.getDictObj([\n    'sys_vadmin_platform',\n    'crm_record_issue_type',\n    'crm_record_assigned_user'\n  ])\n  platformOptions.value = dictOptions.sys_vadmin_platform\n  issue_typeOptions.value = dictOptions.crm_record_issue_type\n  assigned_userOptions.value = dictOptions.crm_record_assigned_user\n}\n\ngetOptions()\n\nconst tableColumns = reactive<TableColumn[]>([\n  {\n    field: 'name',\n    label: '業務姓名',\n    width: '100px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'customer_type',\n    label: '拜訪店類型',\n    width: '120px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'customer_name',\n    label: '客戶名稱',\n    width: '150px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'visit_period',\n    label: '拜訪時間',\n    width: '180px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'purpose',\n    label: '拜訪目的',\n    width: '150px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'content',\n    label: '拜訪內容',\n    width: '300px',\n    show: true,\n    showOverflowTooltip: false,\n    slots: {\n      default: ({ row }) => {\n        return (\n          <div style=\"white-space: normal; word-break: break-word; line-height: 1.5; font-size: 14px;\">\n            {row.content}\n          </div>\n        )\n      }\n    }\n  },\n  {\n    field: 'issue_type',\n    label: '問題類型',\n    show: false,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <div>{selectDictLabel(unref(issue_typeOptions), row.issue_type)}</div>\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'assigned_user',\n    label: '指派人員',\n    width: '100px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'visit_period',\n    label: '預計回覆日期',\n    width: '180px',\n    show: true,\n    disabled: true\n  },\n  {\n    field: 'is_closed',\n    label: '是否結案',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        return (\n          <>\n            <ElSwitch modelValue={row.is_closed} disabled />\n          </>\n        )\n      }\n    }\n  },\n  {\n    field: 'action',\n    label: '操作',\n    width: '200px',\n    show: true,\n    slots: {\n      default: (data: any) => {\n        const row = data.row\n        const update = ['crm.visit.record.update']\n        const del = ['crm.visit.record.delete']\n        return (\n          <>\n            <BaseButton\n              type=\"primary\"\n              v-hasPermi={update}\n              link\n              size=\"small\"\n              onClick={() => editAction(row)}\n            >\n              回覆\n            </BaseButton>\n            <BaseButton\n              type=\"primary\"\n              v-hasPermi={update}\n              link\n              size=\"small\"\n              onClick={() => editAction(row)}\n            >\n              編輯\n            </BaseButton>\n            <BaseButton\n              type=\"danger\"\n              v-hasPermi={del}\n              loading={delLoading.value}\n              link\n              size=\"small\"\n              onClick={() => delData(row)}\n            >\n              删除\n            </BaseButton>\n          </>\n        )\n      }\n    }\n  }\n])\n\nconst searchSchema = reactive<FormSchema[]>([\n  {\n    field: 'name',\n    label: '業務姓名',\n    component: 'Input',\n    componentProps: {\n      clearable: true,\n      style: { width: '214px' }\n    }\n  },\n  {\n    field: 'visit_type',\n    label: '拜訪店類型',\n    component: 'Input',\n    componentProps: {\n      clearable: true,\n      style: { width: '214px' }\n    }\n  },\n  {\n    field: 'purpose',\n    label: '拜訪目的',\n    component: 'Input',\n    componentProps: {\n      clearable: true,\n      style: { width: '214px' }\n    }\n  },\n  {\n    field: 'create_datetime',\n    label: '建立時間',\n    component: 'Input',\n    componentProps: {\n      clearable: true,\n      style: { width: '214px' }\n    }\n  }\n])\n\nconst searchParams = ref({})\nconst setSearchParams = (data: any) => {\n  currentPage.value = 1\n  searchParams.value = data\n  getList()\n}\n\nconst delLoading = ref(false)\n\nconst delData = async (row: any) => {\n  delLoading.value = true\n  await delList(true, [row.id]).finally(() => {\n    delLoading.value = false\n  })\n}\n\nconst dialogVisible = ref(false)\nconst dialogTitle = ref('')\n\nconst currentRow = ref()\nconst actionType = ref('')\n\nconst writeRef = ref<ComponentRef<typeof Write>>()\n\nconst saveLoading = ref(false)\n\nconst editAction = async (row: any) => {\n  const res = await getCrmVisitRecordApi(row.id)\n  if (res) {\n    dialogTitle.value = '編輯資料'\n    actionType.value = 'edit'\n    currentRow.value = res.data\n    dialogVisible.value = true\n  }\n}\n\nconst addAction = () => {\n  dialogTitle.value = '新增資料'\n  actionType.value = 'add'\n  currentRow.value = undefined\n  dialogVisible.value = true\n}\n\nconst add = ['crm.visit.record.create']\n\nconst save = async () => {\n  const write = unref(writeRef)\n  const formData = await write?.submit()\n  if (formData) {\n    saveLoading.value = true\n    try {\n      const res = ref({})\n      if (actionType.value === 'add') {\n        res.value = await addCrmVisitRecordApi(formData)\n        if (res.value) {\n          dialogVisible.value = false\n          getList()\n        }\n      } else if (actionType.value === 'edit') {\n        res.value = await putCrmVisitRecordApi(formData)\n        if (res.value) {\n          dialogVisible.value = false\n          getList()\n        }\n      }\n    } finally {\n      saveLoading.value = false\n    }\n  }\n}\n</script>\n\n<template>\n  <ContentWrap>\n    <Search :schema=\"searchSchema\" @reset=\"setSearchParams\" @search=\"setSearchParams\" />\n    <Table\n      v-model:current-page=\"currentPage\"\n      v-model:page-size=\"pageSize\"\n      showAction\n      :columns=\"tableColumns\"\n      default-expand-all\n      table-layout=\"auto\"\n      node-key=\"id\"\n      :data=\"dataList\"\n      :loading=\"loading\"\n      :pagination=\"{\n        total\n      }\"\n      @register=\"tableRegister\"\n      @refresh=\"getList\"\n    >\n      <template #toolbar>\n        <ElRow :gutter=\"10\">\n          <ElCol :span=\"1.5\">\n            <BaseButton type=\"primary\" v-hasPermi=\"{ add }\" @click=\"addAction\">新增資料</BaseButton>\n          </ElCol>\n        </ElRow>\n      </template>\n    </Table>\n  </ContentWrap>\n  <Dialog v-model=\"dialogVisible\" :title=\"dialogTitle\" :height=\"650\">\n    <Write ref=\"writeRef\" :current-row=\"currentRow\" />\n\n    <template #footer>\n      <BaseButton type=\"primary\" :loading=\"saveLoading\" @click=\"save\">\n        {{ t('exampleDemo.save') }}\n      </BaseButton>\n      <BaseButton @click=\"dialogVisible = false\">{{ t('dialogDemo.close') }}</BaseButton>\n    </template>\n  </Dialog>\n</template>\n"],"names":["getCrmVisitRecordListApi","params","request","addCrmVisitRecordApi","data","delCrmVisitRecordApi","putCrmVisitRecordApi","getCrmVisitRecordApi","dataId","t","useI18n","tableRegister","tableState","tableMethods","useTable","fetchDataApi","__async","pageSize","currentPage","res","__spreadValues","page","unref","limit","searchParams","list","total","count","fetchDelApi","value","code","dataList","loading","getList","delList","platformOptions","ref","issue_typeOptions","assigned_userOptions","dictOptions","useDictStore","getDictObj","sys_vadmin_platform","crm_record_issue_type","crm_record_assigned_user","tableColumns","reactive","field","label","width","show","disabled","showOverflowTooltip","slots","default","row","_createVNode2","content","_Fragment2","selectDictLabel","issue_type","ElSwitch","is_closed","update","del","_withDirectives2","BaseButton","onClick","editAction","_createTextVNode2","_resolveDirective2","delLoading","delData","searchSchema","component","componentProps","clearable","style","setSearchParams","id","finally","dialogVisible","dialogTitle","currentRow","actionType","writeRef","saveLoading","addAction","undefined","add","save","write","formData","submit"],"mappings":"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"}