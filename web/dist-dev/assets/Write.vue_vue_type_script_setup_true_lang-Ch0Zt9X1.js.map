{"version":3,"file":"Write.vue_vue_type_script_setup_true_lang-Ch0Zt9X1.js","sources":["../../src/views/Vadmin/System/Task/components/Write.vue"],"sourcesContent":["<script setup lang=\"tsx\">\nimport { Form, FormSchema } from '@/components/Form'\nimport { useForm } from '@/hooks/web/useForm'\nimport { PropType, reactive, watch } from 'vue'\nimport { useValidator } from '@/hooks/web/useValidator'\nimport { useDictStore } from '@/store/modules/dict'\nimport { getTaskGroupOptionsApi } from '@/api/vadmin/system/task'\n\nconst { required } = useValidator()\n\nconst props = defineProps({\n  currentRow: {\n    type: Object as PropType<any>,\n    default: () => null\n  }\n})\n\nconst formSchema = reactive<FormSchema[]>([\n  {\n    field: 'name',\n    label: '任務名稱',\n    component: 'Input',\n    colProps: {\n      span: 12\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      }\n    },\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'group',\n    label: '任務分組',\n    colProps: {\n      span: 12\n    },\n    component: 'Select',\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      allowCreate: true,\n      filterable: true,\n      defaultFirstOption: true,\n      placeholder: '請選擇任務分組，支持直接輸入添加'\n    },\n    optionApi: async () => {\n      const res = await getTaskGroupOptionsApi()\n      return res.data\n    }\n  },\n  {\n    field: 'job_class',\n    label: '調用目標',\n    component: 'Input',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      placeholder: '調用示例：test.main.Test(\"kinit\", 1314)；參數僅支持字串，整數，浮點數，布爾值。'\n    },\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'exec_strategy',\n    label: '執行策略',\n    colProps: {\n      span: 24\n    },\n    component: 'RadioGroup',\n    componentProps: {\n      style: {\n        width: '100%'\n      }\n    },\n    value: 'interval',\n    formItemProps: {\n      rules: [required()]\n    },\n    optionApi: async () => {\n      const dictStore = useDictStore()\n      const dictOptions = await dictStore.getDictObj(['vadmin_system_task_exec_strategy'])\n      return dictOptions.vadmin_system_task_exec_strategy\n    }\n    // formItemProps: {\n    //   slots: {\n    //     default: (data) => {\n    //       return (\n    //         <>\n    //           <ElRadioGroup v-model={data['exec_strategy']} onChange={handleChange(form)}></>\n    //     <ElRadio v-for=\"(item, $index) in execStrategyOptions\" :key=\"\" :label=\"item.value\">{{\n    //       item.label\n    //     }}</ElRadio>\n    //     {}\n    //   </ElRadioGroup>\n    //         </>\n    //       )\n    //     }\n    //   }\n    // }\n  },\n  {\n    field: 'expression',\n    label: '表達式',\n    component: 'Input',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      placeholder:\n        'interval 表達式，五位，分別為：秒 分 時 天 周，例如：10 * * * * 表示每隔 10 秒執行一次任務。'\n    },\n    ifshow: (values) => values.exec_strategy === 'interval',\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'expression',\n    label: '表達式',\n    component: 'Input',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      placeholder: 'cron 表達式，六位或七位，分别表示秒、分钟、小時、天、月、星期幾、年(可選)'\n    },\n    ifshow: (values) => values.exec_strategy === 'cron',\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'expression',\n    label: '執行時間',\n    component: 'DatePicker',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      type: 'datetime',\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'YYYY-MM-DD HH:mm:ss'\n    },\n    ifshow: (values) => values.exec_strategy === 'date',\n    formItemProps: {\n      rules: [required()]\n    }\n  },\n  {\n    field: 'start_date',\n    label: '開始時間',\n    colProps: {\n      span: 12\n    },\n    component: 'DatePicker',\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      type: 'datetime',\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'YYYY-MM-DD HH:mm:ss'\n    },\n    ifshow: (values) => values.exec_strategy !== 'date'\n  },\n  {\n    field: 'end_date',\n    label: '結束時間',\n    colProps: {\n      span: 12\n    },\n    component: 'DatePicker',\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      type: 'datetime',\n      format: 'YYYY-MM-DD HH:mm:ss',\n      valueFormat: 'YYYY-MM-DD HH:mm:ss'\n    },\n    ifshow: (values) => values.exec_strategy !== 'date'\n  },\n  {\n    field: 'is_active',\n    label: '任務狀態',\n    colProps: {\n      span: 8\n    },\n    component: 'RadioGroup',\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      options: [\n        {\n          label: '正常',\n          value: true\n        },\n        {\n          label: '停用',\n          value: false\n        }\n      ]\n    },\n    value: true\n  },\n  {\n    field: '',\n    label: '',\n    colProps: {\n      span: 16\n    },\n    component: 'Text',\n    value:\n      '創建或更新任務完成後，如果任務狀態與設置的不符，請嘗試刷新數據或查看調度日誌，任務狀態可能會有延遲(幾秒)。'\n  },\n  {\n    field: 'remark',\n    label: '備註說明',\n    component: 'Input',\n    colProps: {\n      span: 24\n    },\n    componentProps: {\n      style: {\n        width: '100%'\n      },\n      maxlength: '1000',\n      showWordLimit: true,\n      type: 'textarea',\n      rows: '3'\n    }\n  }\n])\n\nconst { formRegister, formMethods } = useForm()\nconst { setValues, getFormData, getElFormExpose } = formMethods\n\nconst submit = async () => {\n  const elForm = await getElFormExpose()\n  const valid = await elForm?.validate()\n  if (valid) {\n    const formData = await getFormData()\n    return formData\n  }\n}\n\nwatch(\n  () => props.currentRow,\n  (currentRow) => {\n    if (!currentRow) return\n    setValues(currentRow)\n  },\n  {\n    deep: true,\n    immediate: true\n  }\n)\n\ndefineExpose({\n  submit\n})\n</script>\n\n<template>\n  <Form @register=\"formRegister\" :schema=\"formSchema\" />\n</template>\n"],"names":["required","useValidator","props","__props","formSchema","reactive","field","label","component","colProps","span","componentProps","style","width","formItemProps","rules","allowCreate","filterable","defaultFirstOption","placeholder","optionApi","__async","getTaskGroupOptionsApi","data","value","useDictStore","getDictObj","vadmin_system_task_exec_strategy","ifshow","values","exec_strategy","type","format","valueFormat","options","maxlength","showWordLimit","rows","formRegister","formMethods","useForm","setValues","getFormData","getElFormExpose","submit","elForm","validate","watch","currentRow","deep","immediate","__expose"],"mappings":"siBAQA,KAAM,CAAEA,SAAAA,CAAU,EAAGC,EAAY,EAE3BC,EAAQC,EAORC,EAAaC,EAAuB,CACxC,CACEC,MAAO,OACPC,MAAO,OACPC,UAAW,QACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACT,CACD,EACDC,cAAe,CACbC,MAAO,CAACf,GAAU,CACpB,CACF,EACA,CACEM,MAAO,QACPC,MAAO,OACPE,SAAU,CACRC,KAAM,EACP,EACDF,UAAW,SACXG,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDG,YAAa,GACbC,WAAY,GACZC,mBAAoB,GACpBC,YAAa,kBACd,EACDC,UAAW,IAAYC,EAAA,sBAErB,OADY,MAAMC,KACPC,IACb,EACF,EACA,CACEjB,MAAO,YACPC,MAAO,OACPC,UAAW,QACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDM,YAAa,wDACd,EACDL,cAAe,CACbC,MAAO,CAACf,GAAU,CACpB,CACF,EACA,CACEM,MAAO,gBACPC,MAAO,OACPE,SAAU,CACRC,KAAM,EACP,EACDF,UAAW,aACXG,eAAgB,CACdC,MAAO,CACLC,MAAO,MACT,CACD,EACDW,MAAO,WACPV,cAAe,CACbC,MAAO,CAACf,GAAU,CACnB,EACDoB,UAAW,IAAYC,EAAA,sBAGrB,OADoB,MADFI,IACkBC,WAAW,CAAC,kCAAkC,CAAC,GAChEC,gCACrB,EAiBF,EACA,CACErB,MAAO,aACPC,MAAO,MACPC,UAAW,QACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDM,YACE,8DACH,EACDS,OAASC,GAAWA,EAAOC,gBAAkB,WAC7ChB,cAAe,CACbC,MAAO,CAACf,GAAU,CACpB,CACF,EACA,CACEM,MAAO,aACPC,MAAO,MACPC,UAAW,QACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDM,YAAa,0CACd,EACDS,OAASC,GAAWA,EAAOC,gBAAkB,OAC7ChB,cAAe,CACbC,MAAO,CAACf,GAAU,CACpB,CACF,EACA,CACEM,MAAO,aACPC,MAAO,OACPC,UAAW,aACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDkB,KAAM,WACNC,OAAQ,sBACRC,YAAa,qBACd,EACDL,OAASC,GAAWA,EAAOC,gBAAkB,OAC7ChB,cAAe,CACbC,MAAO,CAACf,GAAU,CACpB,CACF,EACA,CACEM,MAAO,aACPC,MAAO,OACPE,SAAU,CACRC,KAAM,EACP,EACDF,UAAW,aACXG,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDkB,KAAM,WACNC,OAAQ,sBACRC,YAAa,qBACd,EACDL,OAASC,GAAWA,EAAOC,gBAAkB,MAC/C,EACA,CACExB,MAAO,WACPC,MAAO,OACPE,SAAU,CACRC,KAAM,EACP,EACDF,UAAW,aACXG,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDkB,KAAM,WACNC,OAAQ,sBACRC,YAAa,qBACd,EACDL,OAASC,GAAWA,EAAOC,gBAAkB,MAC/C,EACA,CACExB,MAAO,YACPC,MAAO,OACPE,SAAU,CACRC,KAAM,CACP,EACDF,UAAW,aACXG,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDqB,QAAS,CACP,CACE3B,MAAO,KACPiB,MAAO,EACT,EACA,CACEjB,MAAO,KACPiB,MAAO,GACT,CAEH,EACDA,MAAO,EACT,EACA,CACElB,MAAO,GACPC,MAAO,GACPE,SAAU,CACRC,KAAM,EACP,EACDF,UAAW,OACXgB,MACE,wDACJ,EACA,CACElB,MAAO,SACPC,MAAO,OACPC,UAAW,QACXC,SAAU,CACRC,KAAM,EACP,EACDC,eAAgB,CACdC,MAAO,CACLC,MAAO,MACR,EACDsB,UAAW,OACXC,cAAe,GACfL,KAAM,WACNM,KAAM,GACR,CACF,CAAA,CACD,EAEK,CAAEC,aAAAA,EAAcC,YAAAA,CAAa,EAAGC,EAAO,EACvC,CAAEC,UAAAA,EAAWC,YAAAA,EAAaC,gBAAAA,CAAiB,EAAGJ,EAE9CK,EAAS,IAAYvB,EAAA,sBACzB,MAAMwB,EAAS,MAAMF,IAErB,GADc,MAAME,GAAAA,YAAAA,EAAQC,WAG1B,OADiB,MAAMJ,MAK3BK,OAAAA,EACE,IAAM7C,EAAM8C,WACXA,GAAe,CACTA,GACLP,EAAUO,CAAU,CACtB,EACA,CACEC,KAAM,GACNC,UAAW,EACb,CACF,EAEAC,EAAa,CACXP,OAAAA,CACF,CAAC"}