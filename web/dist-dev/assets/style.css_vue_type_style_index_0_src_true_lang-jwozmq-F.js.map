{"version":3,"file":"style.css_vue_type_style_index_0_src_true_lang-jwozmq-F.js","sources":["../../src/api/vadmin/system/files.ts","../../src/components/Editor/src/Editor.vue"],"sourcesContent":["import request from '@/config/axios'\n\n// 上傳圖片到阿裡云OSS\nexport const uploadImageToOSSApi = (data: any): Promise<IResponse> => {\n  return request.post({\n    url: `/vadmin/system/upload/image/to/oss`,\n    headersType: 'multipart/form-data',\n    data\n  })\n}\n\n// 上傳圖片到阿裡云OSS\nexport const uploadVideoToOSSApi = (data: any): Promise<IResponse> => {\n  return request.post({\n    url: `/vadmin/system/upload/video/to/oss`,\n    headersType: 'multipart/form-data',\n    data\n  })\n}\n\n// 上傳圖片到阿裡云OSS\nexport const uploadFileToOSSApi = (data: any): Promise<IResponse> => {\n  return request.post({\n    url: `/vadmin/system/upload/file/to/oss`,\n    headersType: 'multipart/form-data',\n    data\n  })\n}\n","<script setup lang=\"ts\">\nimport { onBeforeUnmount, computed, PropType, unref, nextTick, ref, watch, shallowRef } from 'vue'\nimport { Editor, Toolbar } from '@wangeditor/editor-for-vue'\nimport { IDomEditor, IEditorConfig, i18nChangeLanguage } from '@wangeditor/editor'\nimport { propTypes } from '@/utils/propTypes'\nimport { isNumber } from '@/utils/is'\nimport { ElMessage } from 'element-plus'\nimport { useLocaleStore } from '@/store/modules/locale'\nimport { InsertImageType, InsertVideoType } from './types'\nimport { uploadImageToOSSApi, uploadVideoToOSSApi } from '@/api/vadmin/system/files'\n\n// editor 官方文檔：https://www.wangeditor.com/v5/getting-started.html\n\nconst localeStore = useLocaleStore()\n\nconst currentLocale = computed(() => localeStore.getCurrentLocale)\n\ni18nChangeLanguage(unref(currentLocale).lang)\n\nconst props = defineProps({\n  editorId: propTypes.string.def('wangeEditor-1'),\n  height: propTypes.oneOfType([Number, String]).def('500px'),\n  editorConfig: {\n    type: Object as PropType<IEditorConfig>,\n    default: () => undefined\n  },\n  modelValue: propTypes.string.def('')\n})\n\nconst emit = defineEmits(['change', 'update:modelValue'])\n\n// 編輯器實例，必須用 shallowRef\nconst editorRef = shallowRef<IDomEditor>()\n\nconst valueHtml = ref('')\n\nwatch(\n  () => props.modelValue,\n  (val: string) => {\n    if (val === unref(valueHtml)) return\n    valueHtml.value = val\n  },\n  {\n    immediate: true\n  }\n)\n\n// 监听\nwatch(\n  () => valueHtml.value,\n  (val: string) => {\n    emit('update:modelValue', val)\n  }\n)\n\nconst handleCreated = (editor: IDomEditor) => {\n  editorRef.value = editor\n}\n\n// 編輯器配置\nconst editorConfig = computed((): IEditorConfig => {\n  return Object.assign(\n    {\n      readOnly: false,\n      customAlert: (s: string, t: string) => {\n        switch (t) {\n          case 'success':\n            ElMessage.success(s)\n            break\n          case 'info':\n            ElMessage.info(s)\n            break\n          case 'warning':\n            ElMessage.warning(s)\n            break\n          case 'error':\n            ElMessage.error(s)\n            break\n          default:\n            ElMessage.info(s)\n            break\n        }\n      },\n      autoFocus: false,\n      scroll: true,\n      uploadImgShowBase64: true,\n      MENU_CONF: {\n        uploadImage: {\n          // 自定義上傳圖片\n          // 官方文檔：https://www.wangeditor.com/v5/menu-config.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0\n          async customUpload(file: File, insertFn: InsertImageType) {\n            // 上傳圖片前的檢查\n            if (!['image/jpeg', 'image/gif', 'image/png'].includes(file.type)) {\n              return ElMessage.error(`${file.name}上傳失敗：上傳圖片只能是 JPG/GIF/PNG/ 格式!`)\n            }\n            if (!(file.size / 1024 / 1024 < 2)) {\n              return ElMessage.error(`${file.name}上傳失敗：上傳圖片大小不能超過 2MB!`)\n            }\n\n            // 自己實现上傳，並得到圖片 url\n            const formData = new FormData()\n            formData.append('file', file)\n            formData.append('path', 'editor/image')\n            const res = await uploadImageToOSSApi(formData)\n            insertFn(res.data, '', res.data)\n          }\n        },\n        uploadVideo: {\n          // 自定義上傳視頻\n          // 官方文檔：https://www.wangeditor.com/v5/menu-config.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8A%9F%E8%83%BD-1\n          async customUpload(file: File, insertFn: InsertVideoType) {\n            // 上傳視頻前的檢查\n            if (!['video/mp4', 'video/mpeg'].includes(file.type)) {\n              return ElMessage.error(`${file.name}上傳失敗：上傳視頻只能是 mp4/mpeg/ 格式!`)\n            }\n            if (!(file.size / 1024 / 1024 < 5)) {\n              return ElMessage.error(`${file.name}上傳失敗：上傳視頻大小不能超過 5MB!`)\n            }\n            // 自己實现上傳，並得到視頻 url\n            const formData = new FormData()\n            formData.append('file', file)\n            formData.append('path', 'editor/video')\n            const res = await uploadVideoToOSSApi(formData)\n            insertFn(res.data, '')\n          }\n        }\n      }\n    },\n    props.editorConfig || {}\n  )\n})\n\nconst editorStyle = computed(() => {\n  return {\n    height: isNumber(props.height) ? `${props.height}px` : props.height\n  }\n})\n\n// 回調函數\nconst handleChange = (editor: IDomEditor) => {\n  emit('change', editor)\n}\n\n// 组件銷毁時，及時銷毁編輯器\nonBeforeUnmount(() => {\n  const editor = unref(editorRef.value)\n\n  // 銷毁，並移除 editor\n  editor?.destroy()\n})\n\nconst getEditorRef = async (): Promise<IDomEditor> => {\n  await nextTick()\n  return unref(editorRef.value) as IDomEditor\n}\n\ndefineExpose({\n  getEditorRef\n})\n</script>\n\n<template>\n  <div class=\"border-1 border-solid border-[var(--el-border-color)] z-10\">\n    <!-- 工具欄 -->\n    <Toolbar\n      :editor=\"editorRef\"\n      :editorId=\"editorId\"\n      class=\"border-0 b-b-1 border-solid border-[var(--el-border-color)]\"\n    />\n    <!-- 編輯器 -->\n    <Editor\n      v-model=\"valueHtml\"\n      :editorId=\"editorId\"\n      :defaultConfig=\"editorConfig\"\n      :style=\"editorStyle\"\n      @on-change=\"handleChange\"\n      @on-created=\"handleCreated\"\n    />\n  </div>\n</template>\n\n<style src=\"@wangeditor/editor/dist/css/style.css\"></style>\n"],"names":["uploadImageToOSSApi","data","request","uploadVideoToOSSApi","localeStore","useLocaleStore","currentLocale","computed","i18nChangeLanguage","unref","props","__props","emit","__emit","editorRef","shallowRef","valueHtml","ref","watch","val","handleCreated","editor","editorConfig","s","t","ElMessage","file","insertFn","__async","formData","res","editorStyle","isNumber","handleChange","onBeforeUnmount","__expose","nextTick"],"mappings":"0eAGa,MAAAA,EAAuBC,GAC3BC,EAAQ,KAAK,CAClB,IAAK,qCACL,YAAa,sBACb,KAAAD,CAAA,CACD,EAIUE,EAAuBF,GAC3BC,EAAQ,KAAK,CAClB,IAAK,qCACL,YAAa,sBACb,KAAAD,CAAA,CACD,oUCJH,MAAMG,EAAcC,IAEdC,EAAgBC,EAAS,IAAMH,EAAY,gBAAgB,EAE9CI,EAAAC,EAAMH,CAAa,EAAE,IAAI,EAE5C,MAAMI,EAAQC,EAURC,EAAOC,EAGPC,EAAYC,IAEZC,EAAYC,EAAI,EAAE,EAExBC,EACE,IAAMR,EAAM,WACXS,GAAgB,CACXA,IAAQV,EAAMO,CAAS,IAC3BA,EAAU,MAAQG,EACpB,EACA,CACE,UAAW,EACb,CAAA,EAIFD,EACE,IAAMF,EAAU,MACfG,GAAgB,CACfP,EAAK,oBAAqBO,CAAG,CAC/B,CAAA,EAGI,MAAAC,EAAiBC,GAAuB,CAC5CP,EAAU,MAAQO,CAAA,EAIdC,EAAef,EAAS,IACrB,OAAO,OACZ,CACE,SAAU,GACV,YAAa,CAACgB,EAAWC,IAAc,CACrC,OAAQA,EAAG,CACT,IAAK,UACHC,EAAU,QAAQF,CAAC,EACnB,MACF,IAAK,OACHE,EAAU,KAAKF,CAAC,EAChB,MACF,IAAK,UACHE,EAAU,QAAQF,CAAC,EACnB,MACF,IAAK,QACHE,EAAU,MAAMF,CAAC,EACjB,MACF,QACEE,EAAU,KAAKF,CAAC,EAChB,KACJ,CACF,EACA,UAAW,GACX,OAAQ,GACR,oBAAqB,GACrB,UAAW,CACT,YAAa,CAGL,aAAaG,EAAYC,EAA2B,QAAAC,EAAA,sBAEpD,GAAA,CAAC,CAAC,aAAc,YAAa,WAAW,EAAE,SAASF,EAAK,IAAI,EAC9D,OAAOD,EAAU,MAAM,GAAGC,EAAK,IAAI,+BAA+B,EAEpE,GAAI,EAAEA,EAAK,KAAO,KAAO,KAAO,GAC9B,OAAOD,EAAU,MAAM,GAAGC,EAAK,IAAI,sBAAsB,EAIrD,MAAAG,EAAW,IAAI,SACZA,EAAA,OAAO,OAAQH,CAAI,EACnBG,EAAA,OAAO,OAAQ,cAAc,EAChC,MAAAC,EAAM,MAAM9B,EAAoB6B,CAAQ,EAC9CF,EAASG,EAAI,KAAM,GAAIA,EAAI,IAAI,CACjC,GACF,EACA,YAAa,CAGL,aAAaJ,EAAYC,EAA2B,QAAAC,EAAA,sBAEpD,GAAA,CAAC,CAAC,YAAa,YAAY,EAAE,SAASF,EAAK,IAAI,EACjD,OAAOD,EAAU,MAAM,GAAGC,EAAK,IAAI,4BAA4B,EAEjE,GAAI,EAAEA,EAAK,KAAO,KAAO,KAAO,GAC9B,OAAOD,EAAU,MAAM,GAAGC,EAAK,IAAI,sBAAsB,EAGrD,MAAAG,EAAW,IAAI,SACZA,EAAA,OAAO,OAAQH,CAAI,EACnBG,EAAA,OAAO,OAAQ,cAAc,EAChC,MAAAC,EAAM,MAAM3B,EAAoB0B,CAAQ,EACrCF,EAAAG,EAAI,KAAM,EAAE,CACvB,GACF,CACF,CACF,EACApB,EAAM,cAAgB,CAAC,CAAA,CAE1B,EAEKqB,EAAcxB,EAAS,KACpB,CACL,OAAQyB,EAAStB,EAAM,MAAM,EAAI,GAAGA,EAAM,MAAM,KAAOA,EAAM,MAAA,EAEhE,EAGKuB,EAAgBZ,GAAuB,CAC3CT,EAAK,SAAUS,CAAM,CAAA,EAIvB,OAAAa,EAAgB,IAAM,CACd,MAAAb,EAASZ,EAAMK,EAAU,KAAK,EAGpCO,GAAA,MAAAA,EAAQ,SAAQ,CACjB,EAOYc,EAAA,CACX,aANmB,IAAiCP,EAAA,sBACpD,aAAMQ,EAAS,EACR3B,EAAMK,EAAU,KAAK,CAAA,EAI5B,CACD"}