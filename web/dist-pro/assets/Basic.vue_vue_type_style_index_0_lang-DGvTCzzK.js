var h=(_,n,r)=>new Promise((c,f)=>{var g=s=>{try{p(r.next(s))}catch(m){f(m)}},w=s=>{try{p(r.throw(s))}catch(m){f(m)}},p=s=>s.done?c(s.value):Promise.resolve(s.value).then(g,w);p((r=r.apply(_,n)).next())});import{u as G,F as E}from"./useForm-DBy6iRN_.js";import{k as L,u as M,a as V,I,q as B,a2 as D,a3 as F}from"./index-ZB82WqWX.js";/* empty css                    */import{u as N}from"./useValidator-3LOiG8nN.js";import{a as P,S,b as l}from"./element-plus-BZE4vQ0t.js";import{l as T,e as R,J as v,O as a,V as j,P as q,a as x,m as J,S as K,u as O}from"./vue-chunks-DM5Q6aJS.js";const ee=T({__name:"Basic",props:{tabId:L.number},setup(_){const{required:n}=N(),r=M(),c=V(),f=_,g=R(()=>r.getToken),w=v([{field:"web_title",label:"系统標題",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"web_logo",label:"系统 LOGO",colProps:{span:24},formItemProps:{slots:{default:e=>a(S,{class:"system-settings-basic-image-uploader",action:"/api/vadmin/system/upload/image/to/local",data:{path:"system"},"show-file-list":!1,"before-upload":o=>{const u=["image/jpeg","image/gif","image/png"].includes(o.type),d=o.size/1024/1024<5;return u||l.error("上傳LOGO圖片必須是 JPG/GIF/PNG/ 格式!"),d||l.error("上傳LOGO圖片大小不能超過 5MB!"),u&&d},"on-success":o=>{o.code===200?e.web_logo=o.data.remote_path:l.error(o.message)},accept:"image/jpeg,image/gif,image/png",name:"file",headers:{Authorization:g}},{default:()=>[e.web_logo?a("img",{src:e.web_logo,class:"logo-image"},null):a(P,{class:"logo-image-uploader-icon"},{default:()=>[a(I,{icon:"akar-icons:plus",size:23},null)]})]})}}},{field:"web_desc",label:"系统描述",colProps:{span:24},component:"Input",componentProps:{rows:4,type:"textarea",style:{width:"500px"}}},{field:"web_ico",label:"ICO 圖標",colProps:{span:24},formItemProps:{slots:{default:e=>a(S,{class:"system-settings-basic-image-uploader",action:"/api/vadmin/system/upload/image/to/local",data:{path:"system"},"show-file-list":!1,"before-upload":o=>{const u=["image/x-icon"].includes(o.type),d=o.size/1024/1024<2;return u||l.error("上傳ICO圖標必須是 ico 格式!"),d||l.error("上傳ICO圖標大小不能超過 2MB!"),u&&d},"on-success":o=>{o.code===200?(e.web_ico=o.data.remote_path,e.web_ico_local_path=o.data.local_path):l.error(o.message)},accept:"image/x-icon",name:"file",headers:{Authorization:g}},{default:()=>[e.web_ico?a("img",{src:e.web_ico,class:"ico-image"},null):a(P,{class:"ico-image-uploader-icon"},{default:()=>[a(I,{icon:"akar-icons:plus",size:23},null)]})]})}}},{field:"web_ico_local_path",label:"ICO 圖標服務器文件地址",component:"Input",colProps:{span:24},hidden:!0},{field:"web_icp_number",label:"備案號",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"web_copyright",label:"版權信息",colProps:{span:24},component:"Input",componentProps:{style:{width:"500px"}}},{field:"active",label:"",colProps:{span:24},formItemProps:{slots:{default:()=>a(q,null,[a(B,{loading:b.value,type:"primary",onClick:C},{default:()=>[j("立即提交")]})])}}}]),p=v({web_title:[n()],web_logo:[n()],web_ico:[n()]}),{formRegister:s,formMethods:m}=G(),{setValues:U,getFormData:k,getElFormExpose:y}=m;let z=x({});const A=()=>h(this,null,function*(){const e=yield F({tab_id:f.tabId});if(e){yield U(e.data),z.value=e.data;const i=yield y();i==null||i.clearValidate()}}),b=x(!1),C=()=>h(this,null,function*(){const e=yield y();if(yield e==null?void 0:e.validate()){const t=yield k();if(b.value=!0,!t)return b.value=!1,l.error("未獲取到數據");try{if(yield D(t))return c.setTitle(t.web_title||"後台系統"),c.setLogoImage(t.web_logo||"/media/system/logo.png"),c.setFooterContent(t.web_copyright||"Copyright ©2022-present K"),c.setIcpNumber(t.web_icp_number||""),l.success("更新成功")}finally{b.value=!1}}});return A(),(e,i)=>(J(),K(O(E),{rules:p,onRegister:O(s),schema:w},null,8,["rules","onRegister","schema"]))}});export{ee as _};
