var _=(E,g,u)=>new Promise((w,c)=>{var i=o=>{try{f(u.next(o))}catch(p){c(p)}},b=o=>{try{f(u.throw(o))}catch(p){c(p)}},f=o=>o.done?w(o.value):Promise.resolve(o.value).then(i,b);f((u=u.apply(E,g)).next())});import{X,Y as I}from"./index-TVUJ5EGw.js";/* empty css                *//* empty css               *//* empty css                        *//* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                    *//* empty css                      *//* empty css                   */import{q as x,h as C,T as M,a0 as N,n as U,x as d,ae as V,w as T,b as v}from"./element-plus-DaxMU9jX.js";import{l as q,a as h,ah as A,m as k,p as P,q as n,O as t,R as s,V as m,u as a,W as z,S as L,P as R}from"./vue-chunks-DM5Q6aJS.js";const j=n("span",null,"導入步驟：",-1),K={style:{"margin-top":"7px"}},O=n("li",{style:{"margin-top":"7px"}},"編輯模板文件，（將需要導入的數據按格式填寫進去）",-1),W=n("li",{style:{"margin-top":"7px"}},"上傳模板文件，點擊確認導入",-1),Y=n("li",{style:{"margin-top":"7px"}},"查看導入结果，是否全部導入",-1),$={class:"mt-10px"},G={class:"flex justify-between mr-10px"},H=n("span",null,"導入结果",-1),J={style:{color:"red"}},ue=q({__name:"Import",emits:["getList"],setup(E,{emit:g}){const u=g,w=l=>{const e=["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(l.type),r=l.size/1024/1024<10;return e||v.error("上傳文件必須是 XLSX 格式!"),r||v.error("上傳文件大小不能超過 10MB!"),e&&r},c=h(),i=h([]),b=h([]),f=l=>_(this,null,function*(){i.value=[],i.value.push({filename:l.file.name,filesize:(l.file.size/1024).toFixed(1)+"KB",status:"上傳成功"}),c.value=l.file}),o=()=>{i.value=[],c.value=null},p=h(!1),B=h(0),D=()=>_(this,null,function*(){p.value=!0;const l=new FormData;l.append("file",c.value);try{const e=yield X(l);e&&(b.value.push({filename:c.value.name,success_number:e.data.success_number,error_number:e.data.error_number,error_url:e.data.error_url}),B.value+=e.data.success_number,o(),u("getList"))}finally{p.value=!1}}),F=()=>_(this,null,function*(){v.info("正在下載請稍等！");const l=yield I();if(l){const e=document.createElement("a");e.style.display="none",e.href=l.data.url,e.target="_blank",e.download=l.data.filename;const r=new MouseEvent("click");e.dispatchEvent(r)}}),S=l=>_(this,null,function*(){v.info("正在下載請稍等！");const e=document.createElement("a");e.style.display="none",e.href=l.error_url,e.target="_blank",e.download=l.filename;const r=new MouseEvent("click");e.dispatchEvent(r)});return(l,e)=>{const r=A("BaseButton");return k(),P(R,null,[n("div",null,[j,n("ol",null,[n("li",K,[t(a(x),{onClick:F,target:"_blank",type:"primary"},{default:s(()=>[m(" 下載最新批量導入模板 ")]),_:1})]),O,W,Y])]),n("div",null,[t(a(U),{gutter:10,class:"!mt-0 !mr-0"},{default:s(()=>[t(a(C),{span:1.5},{default:s(()=>[n("div",null,[t(a(M),{action:"","http-request":f,data:{path:"users"},"show-file-list":!1,"before-upload":w,accept:".xlsx",disabled:i.value.length>0},{default:s(()=>[t(a(N),{effect:"dark",content:"只支持上傳XLSX文件",placement:"top"},{default:s(()=>[t(r,{type:"primary",size:"small",disabled:i.value.length>0},{default:s(()=>[m("上傳文件")]),_:1},8,["disabled"])]),_:1})]),_:1},8,["disabled"])])]),_:1}),t(a(C),{span:1.5},{default:s(()=>[t(r,{type:"primary",size:"small",disabled:i.value.length===0,loading:p.value,onClick:D},{default:s(()=>[m("確認導入")]),_:1},8,["disabled","loading"])]),_:1})]),_:1}),t(a(T),{data:i.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:s(()=>[t(a(d),{prop:"filename",label:"文件名稱",align:"left"}),t(a(d),{prop:"filesize",label:"文件大小",width:"100",align:"center"}),t(a(d),{prop:"status",label:"上傳狀態",width:"100",align:"center"}),t(a(d),{fixed:"right",label:"操作",width:"130",align:"center"},{default:s(()=>[t(a(V),{title:"確認刪除嗎?",onConfirm:o},{reference:s(()=>[t(r,{link:"",type:"primary",size:"small"},{default:s(()=>[m("刪除")]),_:1})]),_:1})]),_:1})]),_:1},8,["data"])]),n("div",$,[n("div",G,[H,n("span",null,"成功導入總數："+z(B.value),1)]),t(a(T),{data:b.value,border:!0,style:{width:"100%"},class:"mt-10px"},{default:s(()=>[t(a(d),{prop:"filename",label:"文件名稱",align:"left"}),t(a(d),{prop:"success_number",label:"成功數量",width:"100",align:"center"}),t(a(d),{prop:"error_number",label:"失敗數量",width:"100",align:"center"},{default:s(y=>[n("span",J,z(y.row.error_number),1)]),_:1}),t(a(d),{fixed:"right",label:"操作",width:"130",align:"center"},{default:s(y=>[y.row.error_number>0?(k(),L(a(x),{key:0,onClick:Q=>S(y.row),target:"_blank",type:"primary"},{default:s(()=>[m("下載失敗數據")]),_:2},1032,["onClick"])):(k(),L(a(x),{key:1,type:"success",underline:!1},{default:s(()=>[m("成功全部導入")]),_:1}))]),_:1})]),_:1},8,["data"])])],64)}}});export{ue as _};
