var xe=Object.defineProperty,ke=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var ae=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,Ie=Object.prototype.propertyIsEnumerable;var le=(s,o,u)=>o in s?xe(s,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[o]=u,j=(s,o)=>{for(var u in o||(o={}))Ae.call(o,u)&&le(s,u,o[u]);if(ae)for(var u of ae(o))Ie.call(o,u)&&le(s,u,o[u]);return s},re=(s,o)=>ke(s,De(o));var m=(s,o,u)=>new Promise((B,S)=>{var L=g=>{try{D(u.next(g))}catch(h){S(h)}},Y=g=>{try{D(u.throw(g))}catch(h){S(h)}},D=g=>g.done?B(g.value):Promise.resolve(g.value).then(L,Y);D((u=u.apply(s,o)).next())});import{r as V,d as Ve,q as v,_ as Be}from"./index-TVUJ5EGw.js";import{a as Se,d as Te,b as Ce}from"./detail-CB3lAfFE.js";import{u as Pe,_ as Re}from"./Table.vue_vue_type_script_lang-Baw7Xmjh.js";/* empty css               *//* empty css                       *//* empty css                 *//* empty css                   *//* empty css               *//* empty css                *//* empty css                  *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";import{_ as $e}from"./Dialog.vue_vue_type_style_index_0_lang-DwvSpjk1.js";import{_ as Ee}from"./Search.vue_vue_type_script_setup_true_lang-BR3CMH1C.js";import{_ as Oe}from"./ContentWrap.vue_vue_type_script_setup_true_lang-BSPWmg2w.js";import{_ as ze}from"./Write.vue_vue_type_script_setup_true_lang-Bj_Q9Cdm.js";import{u as Le}from"./dict-CCE9svEJ.js";import{s as F,n as J,h as I,t as W,u as Ye,v as R,w as Me,x,y as Ue,b as w,z as He}from"./element-plus-DaxMU9jX.js";import{l as Ne,a as d,J as se,O as a,V as f,_ as $,ar as E,P as qe,m as O,p as X,R as n,u as t,B as ie,S as je,W as z,q as b,X as Fe,y as Je,aH as We,aI as Xe}from"./vue-chunks-DM5Q6aJS.js";import"./useForm-8sSQvRCB.js";/* empty css                          *//* empty css                        *//* empty css                       *//* empty css                  *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-DFMD74RT.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                *//* empty css                         */import"./_Uint8Array-DKqHwQen.js";import"./useIcon-BGF3iNGO.js";import"./useValidator-D0Zw1fFG.js";import"./dict-BKIVAwf4.js";const Ge=s=>V.get({url:"/bpmin/it/it",params:s}),Ke=s=>V.post({url:"/bpmin/it/it",data:s}),Qe=s=>V.delete({url:"/bpmin/it/it",data:s}),Ze=s=>V.put({url:`/bpmin/it/it/${s.id}`,data:s}),ne=s=>V.get({url:`/bpmin/it/it/${s}`}),k=s=>(We("data-v-c0c158a4"),s=s(),Xe(),s),et={style:{"margin-bottom":"20px",padding:"15px",border:"1px solid #e4e7ed","border-radius":"4px"}},tt=k(()=>b("h4",{style:{"margin-top":"0"}},"新增歷程記錄",-1)),at=k(()=>b("label",null,"承辦人員：",-1)),lt=k(()=>b("label",null,"處理狀態：",-1)),rt=k(()=>b("label",null,"參照序號：",-1)),st=k(()=>b("label",null,"工作描述：",-1)),it={style:{"margin-top":"15px","text-align":"right"}},nt=k(()=>b("h4",null,"歷程記錄",-1)),ot={key:0,style:{"text-align":"center",padding:"20px",color:"#909399"}};function ut(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!Je(s)}const dt=Ne({name:"BpminIt",__name:"It",setup(s){const{t:o}=Ve(),{tableRegister:u,tableState:B,tableMethods:S}=Pe({fetchDataApi:()=>m(this,null,function*(){const{pageSize:l,currentPage:e}=B,r=yield Ge(j({page:t(e),limit:t(l)},t(G)));return{list:r.data||[],total:r.count||0}}),fetchDelApi:l=>m(this,null,function*(){return(yield Qe(l)).code===200})}),{dataList:L,loading:Y,total:D,pageSize:g,currentPage:h}=B,{getList:A,delList:oe}=S,ue=d([]);m(this,null,function*(){const e=yield Le().getDictObj(["sys_vadmin_platform"]);ue.value=e.sys_vadmin_platform}),m(this,null,function*(){yield A()});const de=se([{field:"serial_number",label:"表單序號",width:"220px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"apply_date",label:"申請日期",width:"120px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"dept",label:"申請單位",width:"130px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"fillman",label:"申請人",width:"180px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"main_apply_item",label:"申請項目",width:"250px",show:!0,disabled:!0,showOverflowTooltip:!1,align:"center",headerAlign:"center"},{field:"request_desc",label:"需求描述",width:"150px",show:!0,disabled:!0,showOverflowTooltip:!1,className:"text-wrap-column",align:"center",headerAlign:"center"},{field:"it_undertaker",label:"IT承辦人",width:"180px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"is_delete",label:"表單狀態",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center",slots:{default:l=>{const r=l.row.is_delete;return a(F,{type:r==="已結案"?"success":"warning"},{default:()=>[r||"未結案"]})}}},{field:"elapsed_days",label:"經過時間",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center",slots:{default:l=>{const r=l.row.elapsed_days;return r==null?a("span",null,[f("-")]):a("span",null,[r,f(" 天")])}}},{field:"latest_processing_status",label:"處理狀態",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center",slots:{default:l=>{const r=l.row.latest_processing_status;if(!r)return a("span",{style:"color: #909399;"},[f("-")]);let p="info";return r==="已完成"?p="success":r==="處理中"?p="primary":r==="已暫停"?p="warning":r==="已取消"&&(p="danger"),a(F,{type:p},ut(r)?r:{default:()=>[r]})}}},{field:"datediff",label:"處理天數",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"action",label:"操作",width:"200px",show:!0,slots:{default:l=>{const e=l.row,r=["bpmin.it.it.update"],p=["bpmin.it.it.delete"];return a(qe,null,[$(a(v,{type:"primary",link:!0,size:"small",onClick:()=>me(e)},{default:()=>[f("詳細")]}),[[E("hasPermi"),r]]),a(v,{type:"success",link:!0,size:"small",onClick:()=>_e(e)},{default:()=>[f("處理歷程")]}),$(a(v,{type:"danger",loading:M.value,link:!0,size:"small",onClick:()=>pe(e)},{default:()=>[f("删除")]}),[[E("hasPermi"),p]])])}}}]),ce=se([{field:"serial_number",label:"表單序號",component:"Input",componentProps:{clearable:!0,style:{width:"214px"},placeholder:"請輸入表單序號"}},{field:"apply_date",label:"申請日期",component:"DatePicker",componentProps:{clearable:!0,type:"date",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"214px"},placeholder:"請選擇申請日期"}},{field:"it_undertaker",label:"IT承辦人",component:"Input",componentProps:{clearable:!0,style:{width:"214px"},placeholder:"請輸入IT承辦人"}}]),G=d({}),K=l=>{h.value=1,G.value=l,A()},M=d(!1),pe=l=>m(this,null,function*(){M.value=!0,yield oe(!0,[l.id]).finally(()=>{M.value=!1})}),y=d(!1),U=d(""),_=d(),T=d(""),Q=d(),H=d(!1),me=l=>m(this,null,function*(){const e=yield ne(l.id);e&&(U.value="詳細資料",T.value="edit",_.value=e.data,y.value=!0)}),fe=()=>{U.value="新增資料",T.value="add",_.value=void 0,y.value=!0},ge=["bpmin.it.it.create"],C=d(!1),Z=d(""),P=d([]),N=d(!1),c=d({work_desc:"",rsn:"",status:"",create_user:""}),_e=l=>m(this,null,function*(){const e=yield ne(l.id);e&&(_.value=e.data,c.value.rsn=e.data.serial_number,c.value.create_user=e.data.it_undertaker||"",Z.value=`處理歷程 - ${l.serial_number}`,C.value=!0,yield q())}),q=()=>m(this,null,function*(){var l,e;if((l=_.value)!=null&&l.serial_number){N.value=!0;try{const r={rsn:_.value.serial_number,page:1,limit:100},p=yield Se(r),i=((e=p.data)==null?void 0:e.filter(ee=>{var te;return ee.rsn===((te=_.value)==null?void 0:te.serial_number)}))||[];P.value=i}catch(r){console.error("獲取表單歷程失敗:",r),P.value=[]}finally{N.value=!1}}}),ve=l=>m(this,null,function*(){var e;try{return(yield Ce(re(j({},l),{rsn:(e=_.value)==null?void 0:e.serial_number}))).code===200?(yield q(),!0):!1}catch(r){return console.error("新增歷程記錄失敗:",r),!1}}),we=()=>m(this,null,function*(){var e,r;if(!c.value.create_user){w.warning("請輸入處理人");return}if(!c.value.status){w.warning("請選擇狀態");return}if(!c.value.work_desc){w.warning("請輸入工作描述");return}(yield ve(c.value))?(w.success("新增歷程記錄成功"),c.value={work_desc:"",rsn:((e=_.value)==null?void 0:e.serial_number)||"",status:"",create_user:((r=_.value)==null?void 0:r.it_undertaker)||""}):w.error("新增歷程記錄失敗")}),be=l=>m(this,null,function*(){if(!l.id){w.error("無效的記錄ID");return}try{yield He.confirm(`確定要刪除這筆歷程記錄嗎？
承辦人員: ${l.create_user}
工作描述: ${l.work_desc}`,"確認刪除",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"});const e=yield Te([l.id]);e&&e.code===200?(w.success("刪除歷程記錄成功"),yield q()):w.error("刪除歷程記錄失敗")}catch(e){e!=="cancel"&&(console.error("刪除歷程記錄失敗:",e),w.error("刪除歷程記錄失敗"))}}),he=l=>{switch(l){case"已完成":return"success";case"處理中":return"primary";case"已暫停":return"warning";case"已取消":return"danger";default:return"info"}},ye=()=>m(this,null,function*(){const l=t(Q),e=yield l==null?void 0:l.submit();if(e){H.value=!0;try{const r=d({});T.value==="add"?(r.value=yield Ke(e),r.value&&(y.value=!1,A())):T.value==="edit"&&(r.value=yield Ze(e),r.value&&(y.value=!1,A()))}finally{H.value=!1}}});return(l,e)=>{const r=E("hasPermi"),p=E("loading");return O(),X("div",null,[a(t(Oe),null,{default:n(()=>[a(t(Ee),{schema:ce,onReset:K,onSearch:K},null,8,["schema"]),a(t(Re),{"current-page":t(h),"onUpdate:currentPage":e[0]||(e[0]=i=>ie(h)?h.value=i:null),"page-size":t(g),"onUpdate:pageSize":e[1]||(e[1]=i=>ie(g)?g.value=i:null),showAction:"",columns:de,"default-expand-all":"","node-key":"id",data:t(L),loading:t(Y),pagination:{total:t(D)},onRegister:t(u),onRefresh:t(A)},{toolbar:n(()=>[a(t(J),{gutter:10},{default:n(()=>[a(t(I),{span:1.5},{default:n(()=>[$((O(),je(t(v),{type:"primary",onClick:fe},{default:n(()=>[f("新增資料")]),_:1})),[[r,{add:ge}]])]),_:1})]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),a(t($e),{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=i=>y.value=i),title:U.value,height:650},{footer:n(()=>[a(t(v),{type:"primary",loading:H.value,onClick:ye},{default:n(()=>[f(z(t(o)("exampleDemo.save")),1)]),_:1},8,["loading"]),a(t(v),{onClick:e[2]||(e[2]=i=>y.value=!1)},{default:n(()=>[f(z(t(o)("dialogDemo.close")),1)]),_:1})]),default:n(()=>[a(ze,{ref_key:"writeRef",ref:Q,"current-row":_.value},null,8,["current-row"])]),_:1},8,["modelValue","title"]),a(t(Ue),{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=i=>C.value=i),title:Z.value,width:800,draggable:"","destroy-on-close":!0,"close-on-click-modal":!1},{footer:n(()=>[a(t(v),{onClick:e[7]||(e[7]=i=>C.value=!1)},{default:n(()=>[f(z(t(o)("dialogDemo.close")),1)]),_:1})]),default:n(()=>[$((O(),X("div",null,[b("div",et,[tt,a(t(J),{gutter:20},{default:n(()=>[a(t(I),{span:8},{default:n(()=>[at,a(t(W),{modelValue:c.value.create_user,"onUpdate:modelValue":e[4]||(e[4]=i=>c.value.create_user=i),readonly:"",placeholder:"請輸入承辦人員"},null,8,["modelValue"])]),_:1}),a(t(I),{span:5},{default:n(()=>[lt,a(t(Ye),{modelValue:c.value.status,"onUpdate:modelValue":e[5]||(e[5]=i=>c.value.status=i),placeholder:"請選擇狀態",style:{width:"100%"}},{default:n(()=>[a(t(R),{label:"處理中",value:"處理中"}),a(t(R),{label:"已完成",value:"已完成"}),a(t(R),{label:"已暫停",value:"已暫停"}),a(t(R),{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1}),a(t(I),{span:9},{default:n(()=>{var i;return[rt,a(t(W),{value:(i=_.value)==null?void 0:i.serial_number,readonly:"",placeholder:"自動填入"},null,8,["value"])]}),_:1})]),_:1}),a(t(J),{style:{"margin-top":"15px"}},{default:n(()=>[a(t(I),{span:24},{default:n(()=>[st,a(t(W),{modelValue:c.value.work_desc,"onUpdate:modelValue":e[6]||(e[6]=i=>c.value.work_desc=i),type:"textarea",rows:3,placeholder:"請輸入工作描述"},null,8,["modelValue"])]),_:1})]),_:1}),b("div",it,[a(t(v),{type:"primary",onClick:we},{default:n(()=>[f("新增記錄")]),_:1})])]),b("div",null,[nt,a(t(Me),{data:P.value,border:"",style:{width:"100%"}},{default:n(()=>[a(t(x),{prop:"create_user",label:"承辦人員",width:"120",align:"center"}),a(t(x),{prop:"status",label:"處理狀態",width:"100",align:"center"},{default:n(({row:i})=>[a(t(F),{type:he(i.status)},{default:n(()=>[f(z(i.status),1)]),_:2},1032,["type"])]),_:1}),a(t(x),{prop:"rsn",label:"參照序號",width:"120",align:"center"}),a(t(x),{prop:"work_desc",label:"工作描述","show-overflow-tooltip":""}),a(t(x),{prop:"create_datetime",label:"建立時間",width:"160",align:"center"}),a(t(x),{label:"操作",width:"80",align:"center"},{default:n(({row:i})=>[a(t(v),{type:"danger",size:"small",link:"",onClick:ee=>be(i)},{default:n(()=>[f(" 刪除 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),P.value.length===0?(O(),X("div",ot," 暫無歷程記錄 ")):Fe("",!0)])])),[[p,N.value]])]),_:1},8,["modelValue","title"])])}}}),Kt=Be(dt,[["__scopeId","data-v-c0c158a4"]]);export{Kt as default};
