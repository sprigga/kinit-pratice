var ye=Object.defineProperty,xe=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ae=(s,n,u)=>n in s?ye(s,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[n]=u,H=(s,n)=>{for(var u in n||(n={}))Ae.call(n,u)&&ae(s,u,n[u]);if(te)for(var u of te(n))De.call(n,u)&&ae(s,u,n[u]);return s},le=(s,n)=>xe(s,ke(n));var m=(s,n,u)=>new Promise((S,T)=>{var z=g=>{try{x(u.next(g))}catch(w){T(w)}},Y=g=>{try{x(u.throw(g))}catch(w){T(w)}},x=g=>g.done?S(g.value):Promise.resolve(g.value).then(z,Y);x((u=u.apply(s,n)).next())});import{r as V,d as Ie,q as b,_ as Ve}from"./index-ZB82WqWX.js";import{a as Se,b as Te}from"./detail-BPayK0BP.js";import{u as Ce,_ as Pe}from"./Table.vue_vue_type_script_lang-B50UL5V4.js";/* empty css               *//* empty css                 *//* empty css               *//* empty css                *//* empty css                  *//* empty css                        */import"./el-tooltip-l0sNRNKZ.js";import{_ as Be}from"./Dialog.vue_vue_type_style_index_0_lang-DrJbK1te.js";/* empty css                   */import{_ as Re}from"./Search.vue_vue_type_script_setup_true_lang-MmNnJDq7.js";import{_ as Ee}from"./ContentWrap.vue_vue_type_script_setup_true_lang-ClFoywJU.js";import{_ as Oe}from"./Write.vue_vue_type_script_setup_true_lang-DSZHQd0Q.js";import{u as $e}from"./dict-BekaM8XJ.js";import{s as j,n as F,h as A,t as J,u as Le,v as R,w as ze,x as D,y as Ye,b as I}from"./element-plus-BZE4vQ0t.js";import{l as Ue,a as d,J as re,O as a,V as f,_ as E,ar as O,P as Me,m as $,p as W,R as o,u as t,B as se,S as Ne,W as L,q as v,X as qe,y as He,aH as je,aI as Fe}from"./vue-chunks-DM5Q6aJS.js";/* empty css                       */import"./useForm-DBy6iRN_.js";/* empty css                          *//* empty css                        *//* empty css                       *//* empty css                  *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-7xoOJBR1.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                *//* empty css                         */import"./_Uint8Array-DKqHwQen.js";import"./useIcon-CC7FO7rO.js";import"./useValidator-3LOiG8nN.js";import"./dict-wI1ILLdR.js";const Je=s=>V.get({url:"/bpmin/it/it",params:s}),We=s=>V.post({url:"/bpmin/it/it",data:s}),Xe=s=>V.delete({url:"/bpmin/it/it",data:s}),Ge=s=>V.put({url:`/bpmin/it/it/${s.id}`,data:s}),ie=s=>V.get({url:`/bpmin/it/it/${s}`}),y=s=>(je("data-v-3a34bc40"),s=s(),Fe(),s),Ke={style:{"margin-bottom":"20px",padding:"15px",border:"1px solid #e4e7ed","border-radius":"4px"}},Qe=y(()=>v("h4",{style:{"margin-top":"0"}},"新增歷程記錄",-1)),Ze=y(()=>v("label",null,"承辦人員：",-1)),et=y(()=>v("label",null,"處理狀態：",-1)),tt=y(()=>v("label",null,"參照序號：",-1)),at=y(()=>v("label",null,"工作描述：",-1)),lt={style:{"margin-top":"15px","text-align":"right"}},rt=y(()=>v("h4",null,"歷程記錄",-1)),st={key:0,style:{"text-align":"center",padding:"20px",color:"#909399"}};function it(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!He(s)}const ot=Ue({name:"BpminIt",__name:"It",setup(s){const{t:n}=Ie(),{tableRegister:u,tableState:S,tableMethods:T}=Ce({fetchDataApi:()=>m(this,null,function*(){const{pageSize:r,currentPage:e}=S,l=yield Je(H({page:t(e),limit:t(r)},t(X)));return{list:l.data||[],total:l.count||0}}),fetchDelApi:r=>m(this,null,function*(){return(yield Xe(r)).code===200})}),{dataList:z,loading:Y,total:x,pageSize:g,currentPage:w}=S,{getList:k,delList:oe}=T,ne=d([]);m(this,null,function*(){const e=yield $e().getDictObj(["sys_vadmin_platform"]);ne.value=e.sys_vadmin_platform}),m(this,null,function*(){yield k()});const ue=re([{field:"serial_number",label:"表單序號",width:"220px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"apply_date",label:"申請日期",width:"120px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"dept",label:"申請單位",width:"130px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"fillman",label:"申請人",width:"180px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"main_apply_item",label:"申請項目",width:"250px",show:!0,disabled:!0,showOverflowTooltip:!1,align:"center",headerAlign:"center"},{field:"request_desc",label:"需求描述",width:"150px",show:!0,disabled:!0,showOverflowTooltip:!1,className:"text-wrap-column",align:"center",headerAlign:"center"},{field:"it_undertaker",label:"IT承辦人",width:"180px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"is_delete",label:"表單狀態",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center",slots:{default:r=>{const l=r.row.is_delete;return a(j,{type:l==="已結案"?"success":"warning"},{default:()=>[l||"未結案"]})}}},{field:"elapsed_days",label:"經過時間",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center",slots:{default:r=>{const l=r.row.elapsed_days;return l==null?a("span",null,[f("-")]):a("span",null,[l,f(" 天")])}}},{field:"latest_processing_status",label:"處理狀態",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center",slots:{default:r=>{const l=r.row.latest_processing_status;if(!l)return a("span",{style:"color: #909399;"},[f("-")]);let p="info";return l==="已完成"?p="success":l==="處理中"?p="primary":l==="已暫停"?p="warning":l==="已取消"&&(p="danger"),a(j,{type:p},it(l)?l:{default:()=>[l]})}}},{field:"datediff",label:"處理天數",width:"100px",show:!0,disabled:!0,align:"center",headerAlign:"center"},{field:"action",label:"操作",width:"200px",show:!0,slots:{default:r=>{const e=r.row,l=["bpmin.it.it.update"],p=["bpmin.it.it.delete"];return a(Me,null,[E(a(b,{type:"primary",link:!0,size:"small",onClick:()=>pe(e)},{default:()=>[f("詳細")]}),[[O("hasPermi"),l]]),a(b,{type:"success",link:!0,size:"small",onClick:()=>ge(e)},{default:()=>[f("處理歷程")]}),E(a(b,{type:"danger",loading:U.value,link:!0,size:"small",onClick:()=>ce(e)},{default:()=>[f("删除")]}),[[O("hasPermi"),p]])])}}}]),de=re([{field:"serial_number",label:"表單序號",component:"Input",componentProps:{clearable:!0,style:{width:"214px"},placeholder:"請輸入表單序號"}},{field:"apply_date",label:"申請日期",component:"DatePicker",componentProps:{clearable:!0,type:"date",format:"YYYY-MM-DD",valueFormat:"YYYY-MM-DD",style:{width:"214px"},placeholder:"請選擇申請日期"}},{field:"it_undertaker",label:"IT承辦人",component:"Input",componentProps:{clearable:!0,style:{width:"214px"},placeholder:"請輸入IT承辦人"}}]),X=d({}),G=r=>{w.value=1,X.value=r,k()},U=d(!1),ce=r=>m(this,null,function*(){U.value=!0,yield oe(!0,[r.id]).finally(()=>{U.value=!1})}),h=d(!1),M=d(""),_=d(),C=d(""),K=d(),N=d(!1),pe=r=>m(this,null,function*(){const e=yield ie(r.id);e&&(M.value="詳細資料",C.value="edit",_.value=e.data,h.value=!0)}),me=()=>{M.value="新增資料",C.value="add",_.value=void 0,h.value=!0},fe=["bpmin.it.it.create"],P=d(!1),Q=d(""),B=d([]),q=d(!1),c=d({work_desc:"",rsn:"",status:"",create_user:""}),ge=r=>m(this,null,function*(){const e=yield ie(r.id);e&&(_.value=e.data,c.value.rsn=e.data.serial_number,c.value.create_user=e.data.it_undertaker||"",Q.value=`處理歷程 - ${r.serial_number}`,P.value=!0,yield Z())}),Z=()=>m(this,null,function*(){var r,e;if((r=_.value)!=null&&r.serial_number){q.value=!0;try{const l={rsn:_.value.serial_number,page:1,limit:100},p=yield Se(l),i=((e=p.data)==null?void 0:e.filter(he=>{var ee;return he.rsn===((ee=_.value)==null?void 0:ee.serial_number)}))||[];B.value=i}catch(l){console.error("獲取表單歷程失敗:",l),B.value=[]}finally{q.value=!1}}}),_e=r=>m(this,null,function*(){var e;try{return(yield Te(le(H({},r),{rsn:(e=_.value)==null?void 0:e.serial_number}))).code===200?(yield Z(),!0):!1}catch(l){return console.error("新增歷程記錄失敗:",l),!1}}),ve=()=>m(this,null,function*(){var e,l;if(!c.value.create_user){I.warning("請輸入處理人");return}if(!c.value.status){I.warning("請選擇狀態");return}if(!c.value.work_desc){I.warning("請輸入工作描述");return}(yield _e(c.value))?(I.success("新增歷程記錄成功"),c.value={work_desc:"",rsn:((e=_.value)==null?void 0:e.serial_number)||"",status:"",create_user:((l=_.value)==null?void 0:l.it_undertaker)||""}):I.error("新增歷程記錄失敗")}),we=r=>{switch(r){case"已完成":return"success";case"處理中":return"primary";case"已暫停":return"warning";case"已取消":return"danger";default:return"info"}},be=()=>m(this,null,function*(){const r=t(K),e=yield r==null?void 0:r.submit();if(e){N.value=!0;try{const l=d({});C.value==="add"?(l.value=yield We(e),l.value&&(h.value=!1,k())):C.value==="edit"&&(l.value=yield Ge(e),l.value&&(h.value=!1,k()))}finally{N.value=!1}}});return(r,e)=>{const l=O("hasPermi"),p=O("loading");return $(),W("div",null,[a(t(Ee),null,{default:o(()=>[a(t(Re),{schema:de,onReset:G,onSearch:G},null,8,["schema"]),a(t(Pe),{"current-page":t(w),"onUpdate:currentPage":e[0]||(e[0]=i=>se(w)?w.value=i:null),"page-size":t(g),"onUpdate:pageSize":e[1]||(e[1]=i=>se(g)?g.value=i:null),showAction:"",columns:ue,"default-expand-all":"","node-key":"id",data:t(z),loading:t(Y),pagination:{total:t(x)},onRegister:t(u),onRefresh:t(k)},{toolbar:o(()=>[a(t(F),{gutter:10},{default:o(()=>[a(t(A),{span:1.5},{default:o(()=>[E(($(),Ne(t(b),{type:"primary",onClick:me},{default:o(()=>[f("新增資料")]),_:1})),[[l,{add:fe}]])]),_:1})]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),a(t(Be),{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=i=>h.value=i),title:M.value,height:650},{footer:o(()=>[a(t(b),{type:"primary",loading:N.value,onClick:be},{default:o(()=>[f(L(t(n)("exampleDemo.save")),1)]),_:1},8,["loading"]),a(t(b),{onClick:e[2]||(e[2]=i=>h.value=!1)},{default:o(()=>[f(L(t(n)("dialogDemo.close")),1)]),_:1})]),default:o(()=>[a(Oe,{ref_key:"writeRef",ref:K,"current-row":_.value},null,8,["current-row"])]),_:1},8,["modelValue","title"]),a(t(Ye),{modelValue:P.value,"onUpdate:modelValue":e[8]||(e[8]=i=>P.value=i),title:Q.value,width:800,draggable:"","destroy-on-close":!0,"close-on-click-modal":!1},{footer:o(()=>[a(t(b),{onClick:e[7]||(e[7]=i=>P.value=!1)},{default:o(()=>[f(L(t(n)("dialogDemo.close")),1)]),_:1})]),default:o(()=>[E(($(),W("div",null,[v("div",Ke,[Qe,a(t(F),{gutter:20},{default:o(()=>[a(t(A),{span:8},{default:o(()=>[Ze,a(t(J),{modelValue:c.value.create_user,"onUpdate:modelValue":e[4]||(e[4]=i=>c.value.create_user=i),readonly:"",placeholder:"請輸入承辦人員"},null,8,["modelValue"])]),_:1}),a(t(A),{span:5},{default:o(()=>[et,a(t(Le),{modelValue:c.value.status,"onUpdate:modelValue":e[5]||(e[5]=i=>c.value.status=i),placeholder:"請選擇狀態",style:{width:"100%"}},{default:o(()=>[a(t(R),{label:"處理中",value:"處理中"}),a(t(R),{label:"已完成",value:"已完成"}),a(t(R),{label:"已暫停",value:"已暫停"}),a(t(R),{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),_:1}),a(t(A),{span:9},{default:o(()=>{var i;return[tt,a(t(J),{value:(i=_.value)==null?void 0:i.serial_number,readonly:"",placeholder:"自動填入"},null,8,["value"])]}),_:1})]),_:1}),a(t(F),{style:{"margin-top":"15px"}},{default:o(()=>[a(t(A),{span:24},{default:o(()=>[at,a(t(J),{modelValue:c.value.work_desc,"onUpdate:modelValue":e[6]||(e[6]=i=>c.value.work_desc=i),type:"textarea",rows:3,placeholder:"請輸入工作描述"},null,8,["modelValue"])]),_:1})]),_:1}),v("div",lt,[a(t(b),{type:"primary",onClick:ve},{default:o(()=>[f("新增記錄")]),_:1})])]),v("div",null,[rt,a(t(ze),{data:B.value,border:"",style:{width:"100%"}},{default:o(()=>[a(t(D),{prop:"create_user",label:"承辦人員",width:"120",align:"center"}),a(t(D),{prop:"status",label:"處理狀態",width:"100",align:"center"},{default:o(({row:i})=>[a(t(j),{type:we(i.status)},{default:o(()=>[f(L(i.status),1)]),_:2},1032,["type"])]),_:1}),a(t(D),{prop:"rsn",label:"參照序號",width:"120",align:"center"}),a(t(D),{prop:"work_desc",label:"工作描述","show-overflow-tooltip":""}),a(t(D),{prop:"create_datetime",label:"建立時間",width:"160",align:"center"})]),_:1},8,["data"]),B.value.length===0?($(),W("div",st," 暫無歷程記錄 ")):qe("",!0)])])),[[p,q.value]])]),_:1},8,["modelValue","title"])])}}}),Wt=Ve(ot,[["__scopeId","data-v-3a34bc40"]]);export{Wt as default};
