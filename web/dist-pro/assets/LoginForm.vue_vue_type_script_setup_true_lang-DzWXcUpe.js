var h=(s,w,o)=>new Promise((a,i)=>{var p=t=>{try{r(o.next(t))}catch(n){i(n)}},u=t=>{try{r(o.throw(t))}catch(n){i(n)}},r=t=>t.done?a(t.value):Promise.resolve(t.value).then(p,u);r((o=o.apply(s,w)).next())});import{u as S,F}from"./useForm-8sSQvRCB.js";import{e as q,u as A,q as j,g as B,d as E}from"./index-TVUJ5EGw.js";import{l as M,aB as O,a as g,J as V,O as d,P as C,b as D,m as N,S as z,u as v,y as J}from"./vue-chunks-DM5Q6aJS.js";import{u as L}from"./useValidator-D0Zw1fFG.js";function $(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!J(s)}const U=M({__name:"LoginForm",emits:["to-telephone"],setup(s,{emit:w}){const{required:o}=L(),a=q(),i=A(),{currentRoute:p,addRoute:u,push:r}=O(),{t}=E();g(!1);const n={telephone:[o()],method:[o()],password:[o()]},b=V([{field:"title",colProps:{span:24},formItemProps:{slots:{default:()=>d("h2",{class:"text-2xl font-bold text-center w-[100%]"},[t("login.login")])}}},{field:"telephone",label:t("login.telephone"),value:"",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:t("login.telephonePlaceholder"),maxlength:11}},{field:"password",label:t("login.password"),value:"",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:t("login.passwordPlaceholder")}},{field:"method",label:"登錄類型",value:"0",component:"Input",hidden:!0},{field:"login",colProps:{span:24},formItemProps:{slots:{default:()=>{let e;return d(C,null,[d("div",{class:"w-[100%]"},[d(j,{loading:c.value,type:"primary",class:"w-[100%]",onClick:k},$(e=t("login.login"))?e:{default:()=>[e]})])])}}}}]),{formRegister:P,formMethods:y}=S(),{getFormData:R,getElFormExpose:I}=y,c=g(!1),_=g("");D(()=>p.value,e=>{var l;_.value=(l=e==null?void 0:e.query)==null?void 0:l.redirect},{immediate:!0});const k=()=>h(this,null,function*(){const e=yield I();if(yield e==null?void 0:e.validate()){c.value=!0;const m=yield R();try{const f=yield i.login(m);f?f.data.is_reset_password?x():r({path:"/reset/password"}):c.value=!1}catch(f){c.value=!1}}}),x=()=>h(this,null,function*(){const e=yield B();if(e){const l=e.data||[];yield a.generateRoutes(l).catch(()=>{}),a.getAddRouters.forEach(m=>{u(m)}),a.setIsAddRouters(!0),r({path:_.value||a.addRouters[0].path})}});return(e,l)=>(N(),z(v(F),{schema:b,rules:n,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:v(P)},null,8,["schema","onRegister"]))}});export{U as _};
