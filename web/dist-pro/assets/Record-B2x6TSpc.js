var Z=Object.defineProperty;var T=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var B=(r,s,o)=>s in r?Z(r,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[s]=o,F=(r,s)=>{for(var o in s||(s={}))ee.call(s,o)&&B(r,o,s[o]);if(T)for(var o of T(s))te.call(s,o)&&B(r,o,s[o]);return r};var f=(r,s,o)=>new Promise((h,b)=>{var P=u=>{try{w(o.next(u))}catch(c){b(c)}},D=u=>{try{w(o.throw(u))}catch(c){b(c)}},w=u=>u.done?h(u.value):Promise.resolve(u.value).then(P,D);w((o=o.apply(r,s)).next())});import{r as g,d as ae,q as v}from"./index-C1ugVV0M.js";import{u as re,_ as ie}from"./Table.vue_vue_type_script_lang-CinN-tID.js";/* empty css               *//* empty css                  */import{_ as oe}from"./Search.vue_vue_type_script_setup_true_lang-BvwzElKB.js";import{_ as se}from"./ContentWrap.vue_vue_type_script_setup_true_lang-DchMNHb7.js";import{_ as le}from"./Write.vue_vue_type_script_setup_true_lang-CjCSeahA.js";import{_ as ne}from"./Dialog.vue_vue_type_style_index_0_lang-B2Mf8MAr.js";import{u as ue}from"./dict-D9K4TqBi.js";import{s as de}from"./dict-DLPs-mJD.js";import{A as ce,n as pe,h as me}from"./element-plus-DaxMU9jX.js";import{l as fe,a as n,J as U,O as i,u as a,P as R,_ as k,ar as C,V as _,m as q,p as ve,R as d,B as N,S as _e,W as j}from"./vue-chunks-DM5Q6aJS.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import"./useForm-wf4P-Ogs.js";/* empty css                          *//* empty css                        *//* empty css                       *//* empty css                *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-q8G9uCLO.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                *//* empty css                         */import"./_Uint8Array-DKqHwQen.js";import"./useIcon-DYAT9UAl.js";import"./useValidator-CSahUiaF.js";import"./dict-C7Zbg3Vq.js";const we=r=>g.get({url:"/crm/visit/record",params:r}),ge=r=>g.post({url:"/crm/visit/record",data:r}),he=r=>g.delete({url:"/crm/visit/record",data:r}),be=r=>g.put({url:`/crm/visit/record/${r.id}`,data:r}),ye=r=>g.get({url:`crm/visit/record/${r}`}),lt=fe({name:"CrmVisitRecord",__name:"Record",setup(r){const{t:s}=ae(),{tableRegister:o,tableState:h,tableMethods:b}=re({fetchDataApi:()=>f(this,null,function*(){const{pageSize:t,currentPage:e}=h,l=yield we(F({page:a(e),limit:a(t)},a($)));return{list:l.data||[],total:l.count||0}}),fetchDelApi:t=>f(this,null,function*(){return(yield he(t)).code===200})}),{dataList:P,loading:D,total:w,pageSize:u,currentPage:c}=h,{getList:y,delList:J}=b,M=n([]),O=n([]),W=n([]);f(this,null,function*(){const e=yield ue().getDictObj(["sys_vadmin_platform","crm_record_issue_type","crm_record_assigned_user"]);M.value=e.sys_vadmin_platform,O.value=e.crm_record_issue_type,W.value=e.crm_record_assigned_user});const G=U([{field:"name",label:"業務姓名",width:"100px",show:!0,disabled:!0},{field:"customer_type",label:"拜訪店類型",width:"120px",show:!0,disabled:!0},{field:"customer_name",label:"客戶名稱",width:"150px",show:!0,disabled:!0},{field:"visit_period",label:"拜訪時間",width:"180px",show:!0,disabled:!0},{field:"purpose",label:"拜訪目的",width:"150px",show:!0,disabled:!0},{field:"content",label:"拜訪內容",width:"300px",show:!0,showOverflowTooltip:!1,slots:{default:({row:t})=>i("div",{style:"white-space: normal; word-break: break-word; line-height: 1.5; font-size: 14px;"},[t.content])}},{field:"issue_type",label:"問題類型",show:!1,slots:{default:t=>{const e=t.row;return i(R,null,[i("div",null,[de(a(O),e.issue_type)])])}}},{field:"assigned_user",label:"指派人員",width:"100px",show:!0,disabled:!0},{field:"visit_period",label:"預計回覆日期",width:"180px",show:!0,disabled:!0},{field:"is_closed",label:"是否結案",show:!0,slots:{default:t=>{const e=t.row;return i(R,null,[i(ce,{modelValue:e.is_closed,disabled:!0},null)])}}},{field:"action",label:"操作",width:"200px",show:!0,slots:{default:t=>{const e=t.row,l=["crm.visit.record.update"],p=["crm.visit.record.delete"];return i(R,null,[k(i(v,{type:"primary",link:!0,size:"small",onClick:()=>I(e)},{default:()=>[_("回覆")]}),[[C("hasPermi"),l]]),k(i(v,{type:"primary",link:!0,size:"small",onClick:()=>I(e)},{default:()=>[_("編輯")]}),[[C("hasPermi"),l]]),k(i(v,{type:"danger",loading:V.value,link:!0,size:"small",onClick:()=>K(e)},{default:()=>[_("删除")]}),[[C("hasPermi"),p]])])}}}]),H=U([{field:"name",label:"業務姓名",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"visit_type",label:"拜訪店類型",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"purpose",label:"拜訪目的",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"create_datetime",label:"建立時間",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}}]),$=n({}),L=t=>{c.value=1,$.value=t,y()},V=n(!1),K=t=>f(this,null,function*(){V.value=!0,yield J(!0,[t.id]).finally(()=>{V.value=!1})}),m=n(!1),S=n(""),A=n(),x=n(""),E=n(),z=n(!1),I=t=>f(this,null,function*(){const e=yield ye(t.id);e&&(S.value="編輯資料",x.value="edit",A.value=e.data,m.value=!0)}),Q=()=>{S.value="新增資料",x.value="add",A.value=void 0,m.value=!0},X=["crm.visit.record.create"],Y=()=>f(this,null,function*(){const t=a(E),e=yield t==null?void 0:t.submit();if(e){z.value=!0;try{const l=n({});x.value==="add"?(l.value=yield ge(e),l.value&&(m.value=!1,y())):x.value==="edit"&&(l.value=yield be(e),l.value&&(m.value=!1,y()))}finally{z.value=!1}}});return(t,e)=>{const l=C("hasPermi");return q(),ve(R,null,[i(a(se),null,{default:d(()=>[i(a(oe),{schema:H,onReset:L,onSearch:L},null,8,["schema"]),i(a(ie),{"current-page":a(c),"onUpdate:currentPage":e[0]||(e[0]=p=>N(c)?c.value=p:null),"page-size":a(u),"onUpdate:pageSize":e[1]||(e[1]=p=>N(u)?u.value=p:null),showAction:"",columns:G,"default-expand-all":"","table-layout":"auto","node-key":"id",data:a(P),loading:a(D),pagination:{total:a(w)},onRegister:a(o),onRefresh:a(y)},{toolbar:d(()=>[i(a(pe),{gutter:10},{default:d(()=>[i(a(me),{span:1.5},{default:d(()=>[k((q(),_e(a(v),{type:"primary",onClick:Q},{default:d(()=>[_("新增資料")]),_:1})),[[l,{add:X}]])]),_:1})]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),i(a(ne),{modelValue:m.value,"onUpdate:modelValue":e[3]||(e[3]=p=>m.value=p),title:S.value,height:650},{footer:d(()=>[i(a(v),{type:"primary",loading:z.value,onClick:Y},{default:d(()=>[_(j(a(s)("exampleDemo.save")),1)]),_:1},8,["loading"]),i(a(v),{onClick:e[2]||(e[2]=p=>m.value=!1)},{default:d(()=>[_(j(a(s)("dialogDemo.close")),1)]),_:1})]),default:d(()=>[i(le,{ref_key:"writeRef",ref:E,"current-row":A.value},null,8,["current-row"])]),_:1},8,["modelValue","title"])],64)}}});export{lt as default};
