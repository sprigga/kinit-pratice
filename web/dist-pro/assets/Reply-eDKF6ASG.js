var X=Object.defineProperty;var O=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var I=(a,o,i)=>o in a?X(a,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[o]=i,B=(a,o)=>{for(var i in o||(o={}))Y.call(o,i)&&I(a,i,o[i]);if(O)for(var i of O(o))Z.call(o,i)&&I(a,i,o[i]);return a};var f=(a,o,i)=>new Promise((w,h)=>{var C=s=>{try{v(i.next(s))}catch(c){h(c)}},P=s=>{try{v(i.throw(s))}catch(c){h(c)}},v=s=>s.done?w(s.value):Promise.resolve(s.value).then(C,P);v((i=i.apply(a,o)).next())});import{r as _,d as ee,q as y}from"./index-ZB82WqWX.js";import{u as te,_ as ae}from"./Table.vue_vue_type_script_lang-B50UL5V4.js";/* empty css               */import{_ as ie}from"./Search.vue_vue_type_script_setup_true_lang-MmNnJDq7.js";import{_ as re}from"./ContentWrap.vue_vue_type_script_setup_true_lang-ClFoywJU.js";import{_ as oe}from"./Write.vue_vue_type_script_setup_true_lang-CbmB0Evy.js";import{_ as le}from"./Dialog.vue_vue_type_style_index_0_lang-DrJbK1te.js";import{u as se}from"./dict-BekaM8XJ.js";import{n as ne,h as pe}from"./element-plus-BZE4vQ0t.js";import{l as ue,a as p,J as E,O as l,_ as x,ar as A,V as g,P as T,m as F,p as ce,R as u,u as t,B as U,S as me,W as q}from"./vue-chunks-DM5Q6aJS.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import"./useForm-DBy6iRN_.js";/* empty css                          *//* empty css                        *//* empty css                       *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-7xoOJBR1.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                *//* empty css                         */import"./_Uint8Array-DKqHwQen.js";import"./useIcon-CC7FO7rO.js";import"./useValidator-3LOiG8nN.js";import"./dict-wI1ILLdR.js";const de=a=>_.get({url:"/crm/visit/reply",params:a}),fe=a=>_.post({url:"/crm/visit/reply",data:a}),ve=a=>_.delete({url:"/crm/visit/reply",data:a}),ye=a=>_.put({url:`/crm/visit/reply/${a.id}`,data:a}),ge=a=>_.get({url:`crm/visit/reply/${a}`}),at=ue({name:"CrmVisitReply",__name:"Reply",setup(a){const{t:o}=ee(),{tableRegister:i,tableState:w,tableMethods:h}=te({fetchDataApi:()=>f(this,null,function*(){const{pageSize:r,currentPage:e}=w,n=yield de(B({page:t(e),limit:t(r)},t($)));return{list:n.data||[],total:n.count||0}}),fetchDelApi:r=>f(this,null,function*(){return(yield ve(r)).code===200})}),{dataList:C,loading:P,total:v,pageSize:s,currentPage:c}=w,{getList:R,delList:N}=h,j=p([]);f(this,null,function*(){const e=yield se().getDictObj(["sys_vadmin_platform"]);j.value=e.sys_vadmin_platform});const J=E([{field:"action",label:"操作",width:"200px",show:!0,slots:{default:r=>{const e=r.row,n=["crm.visit.reply.update"],m=["crm.visit.reply.delete"];return l(T,null,[x(l(y,{type:"primary",link:!0,size:"small",onClick:()=>G(e)},{default:()=>[g("編輯")]}),[[A("hasPermi"),n]]),x(l(y,{type:"danger",loading:V.value,link:!0,size:"small",onClick:()=>W(e)},{default:()=>[g("删除")]}),[[A("hasPermi"),m]])])}}}]),M=E([{field:"id",label:"流水號",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"record_id",label:"對應主檔",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"record",label:"回覆內容",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}},{field:"create_datetime",label:"建立時間",component:"Input",componentProps:{clearable:!0,style:{width:"214px"}}}]),$=p({}),z=r=>{c.value=1,$.value=r,R()},V=p(!1),W=r=>f(this,null,function*(){V.value=!0,yield N(!0,[r.id]).finally(()=>{V.value=!1})}),d=p(!1),k=p(""),D=p(),b=p(""),L=p(),S=p(!1),G=r=>f(this,null,function*(){const e=yield ge(r.id);e&&(k.value="編輯資料",b.value="edit",D.value=e.data,d.value=!0)}),H=()=>{k.value="新增資料",b.value="add",D.value=void 0,d.value=!0},K=["crm.visit.reply.create"],Q=()=>f(this,null,function*(){const r=t(L),e=yield r==null?void 0:r.submit();if(e){S.value=!0;try{const n=p({});b.value==="add"?(n.value=yield fe(e),n.value&&(d.value=!1,R())):b.value==="edit"&&(n.value=yield ye(e),n.value&&(d.value=!1,R()))}finally{S.value=!1}}});return(r,e)=>{const n=A("hasPermi");return F(),ce(T,null,[l(t(re),null,{default:u(()=>[l(t(ie),{schema:M,onReset:z,onSearch:z},null,8,["schema"]),l(t(ae),{"current-page":t(c),"onUpdate:currentPage":e[0]||(e[0]=m=>U(c)?c.value=m:null),"page-size":t(s),"onUpdate:pageSize":e[1]||(e[1]=m=>U(s)?s.value=m:null),showAction:"",columns:J,"default-expand-all":"","node-key":"id",data:t(C),loading:t(P),pagination:{total:t(v)},onRegister:t(i),onRefresh:t(R)},{toolbar:u(()=>[l(t(ne),{gutter:10},{default:u(()=>[l(t(pe),{span:1.5},{default:u(()=>[x((F(),me(t(y),{type:"primary",onClick:H},{default:u(()=>[g("新增資料")]),_:1})),[[n,{add:K}]])]),_:1})]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),l(t(le),{modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=m=>d.value=m),title:k.value,height:650},{footer:u(()=>[l(t(y),{type:"primary",loading:S.value,onClick:Q},{default:u(()=>[g(q(t(o)("exampleDemo.save")),1)]),_:1},8,["loading"]),l(t(y),{onClick:e[2]||(e[2]=m=>d.value=!1)},{default:u(()=>[g(q(t(o)("dialogDemo.close")),1)]),_:1})]),default:u(()=>[l(oe,{ref_key:"writeRef",ref:L,"current-row":D.value},null,8,["current-row"])]),_:1},8,["modelValue","title"])],64)}}});export{at as default};
