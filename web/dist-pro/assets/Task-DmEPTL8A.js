var q=Object.defineProperty;var j=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var C=(l,o,t)=>o in l?q(l,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[o]=t,D=(l,o)=>{for(var t in o||(o={}))J.call(o,t)&&C(l,t,o[t]);if(j)for(var t of j(o))E.call(o,t)&&C(l,t,o[t]);return l};var x=(l,o,t)=>new Promise((u,c)=>{var S=r=>{try{m(t.next(r))}catch(d){c(d)}},w=r=>{try{m(t.throw(r))}catch(d){c(d)}},m=r=>r.done?u(r.value):Promise.resolve(r.value).then(S,w);m((t=t.apply(l,o)).next())});import{u as F,_ as M}from"./Table.vue_vue_type_script_lang-B50UL5V4.js";import{d as W,q as O}from"./index-ZB82WqWX.js";import{_ as X}from"./Search.vue_vue_type_script_setup_true_lang-MmNnJDq7.js";import{_ as G}from"./ContentWrap.vue_vue_type_script_setup_true_lang-ClFoywJU.js";import{_ as H}from"./Detail.vue_vue_type_script_setup_true_lang-COATZ6A2.js";import{_ as K}from"./Dialog.vue_vue_type_style_index_0_lang-DrJbK1te.js";import{s as Q}from"./dict-DLPs-mJD.js";import{u as Y}from"./dict-BekaM8XJ.js";import{l as Z,aB as ee,a as p,J as T,O as n,P as y,V as $,m as z,p as te,R as b,u as a,B,W as ae,S as oe,X as se}from"./vue-chunks-DM5Q6aJS.js";import{g as le}from"./task-hzhaHmmj.js";/* empty css                       *//* empty css                 *//* empty css                   */import"./element-plus-BZE4vQ0t.js";/* empty css                        *//* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import"./useForm-DBy6iRN_.js";/* empty css               *//* empty css                          *//* empty css                        *//* empty css                       *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-7xoOJBR1.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                *//* empty css                         */import"./_Uint8Array-DKqHwQen.js";import"./useIcon-CC7FO7rO.js";import"./Descriptions-BPzCjUeo.js";/* empty css              */import"./dict-wI1ILLdR.js";const We=Z({name:"SystemRecordTask",__name:"Task",setup(l){const{t:o}=W(),{currentRoute:t}=ee(),u=t.value.query.job_id,c=p([]);x(this,null,function*(){const e=yield Y().getDictObj(["vadmin_system_task_exec_strategy"]);c.value=e.vadmin_system_task_exec_strategy});const{tableRegister:w,tableState:m,tableMethods:r}=F({immediate:!1,fetchDataApi:()=>x(this,null,function*(){const{pageSize:s,currentPage:e}=m,i=yield le(D({page:a(e),limit:a(s)},a(v)));return{list:i.data||[],total:i.count||0}})}),{dataList:d,loading:A,total:L,pageSize:h,currentPage:f}=m,{getList:_}=r,N=T([{field:"job_id",label:"任務編號",show:!0,disabled:!0,width:"240px"},{field:"name",label:"任務名稱",show:!0,disabled:!0},{field:"group",label:"任務分组",show:!0,span:2},{field:"job_class",label:"調用目標",show:!0},{field:"exec_strategy",label:"執行策略",show:!0,slots:{default:s=>{const e=s.row;return n(y,null,[n("div",null,[Q(c.value,e.exec_strategy)])])}}},{field:"expression",label:"表達式",show:!0,span:24},{field:"start_time",label:"開始執行時間",show:!1,width:"200px"},{field:"end_time",label:"執行完成時間",width:"200px",show:!0},{field:"process_time",label:"耗時(秒)",width:"110px",show:!0},{field:"retval",label:"任務返回值",show:!0,slots:{default:s=>{const e=s.row;return JSON.parse(e.retval)}}},{field:"exception",label:"異常信息",show:!1,span:24},{field:"traceback",label:"堆棧跟踪",show:!1,width:"100px"},{field:"action",width:"100px",label:"操作",show:!0,disabled:!0,slots:{default:s=>{const e=s.row;return n(y,null,[n(O,{type:"primary",link:!0,size:"small",onClick:()=>U(e)},{default:()=>[$("詳情")]})])}}}]),I=T([{field:"job_id",label:"任務編號",component:"Input",componentProps:{clearable:!0,style:{width:"240px"}},value:u},{field:"name",label:"任務名稱",component:"Input",componentProps:{clearable:!0}}]),v=p({}),k=s=>{f.value=1,v.value=s,_()},g=p(!1),R=p(""),P=p(),V=p(""),U=s=>{R.value=o("exampleDemo.detail"),V.value="detail",P.value=s,g.value=!0};return u&&(v.value={job_id:u}),_(),(s,e)=>(z(),te(y,null,[n(a(G),null,{default:b(()=>[n(a(X),{schema:I,onReset:k,onSearch:k},null,8,["schema"]),n(a(M),{"current-page":a(f),"onUpdate:currentPage":e[0]||(e[0]=i=>B(f)?f.value=i:null),"page-size":a(h),"onUpdate:pageSize":e[1]||(e[1]=i=>B(h)?h.value=i:null),showAction:"",columns:N,"node-key":"id",data:a(d),loading:a(A),pagination:{total:a(L)},onRegister:a(w),onRefresh:a(_)},null,8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),n(a(K),{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=i=>g.value=i),title:R.value,width:"800px"},{footer:b(()=>[n(a(O),{onClick:e[2]||(e[2]=i=>g.value=!1)},{default:b(()=>[$(ae(a(o)("dialogDemo.close")),1)]),_:1})]),default:b(()=>[V.value==="detail"?(z(),oe(H,{key:0,"current-row":P.value},null,8,["current-row"])):se("",!0)]),_:1},8,["modelValue","title"])],64))}});export{We as default};
