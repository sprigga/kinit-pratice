var le=Object.defineProperty;var F=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var N=(m,r,o)=>r in m?le(m,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):m[r]=o,E=(m,r)=>{for(var o in r||(r={}))se.call(r,o)&&N(m,o,r[o]);if(F)for(var o of F(r))oe.call(r,o)&&N(m,o,r[o]);return m};var v=(m,r,o)=>new Promise((k,C)=>{var U=u=>{try{L(o.next(u))}catch(h){C(h)}},$=u=>{try{L(o.throw(u))}catch(h){C(h)}},L=u=>u.done?k(u.value):Promise.resolve(u.value).then(U,$);L((o=o.apply(m,r)).next())});import{d as ie,q as w,R as re,S as ne,T as ue,U as de,V as pe,W as me}from"./index-ZB82WqWX.js";import{u as ce,_ as fe}from"./Table.vue_vue_type_script_lang-B50UL5V4.js";/* empty css                  *//* empty css               */import{_ as ve}from"./Search.vue_vue_type_script_setup_true_lang-MmNnJDq7.js";import{_ as we}from"./ContentWrap.vue_vue_type_script_setup_true_lang-ClFoywJU.js";import{_ as _e}from"./Write.vue_vue_type_script_setup_true_lang-DOiRN6yR.js";import{_ as ge}from"./Dialog.vue_vue_type_style_index_0_lang-DrJbK1te.js";import{s as he}from"./dict-DLPs-mJD.js";import{u as be}from"./dict-BekaM8XJ.js";import{_ as ye}from"./Import.vue_vue_type_script_setup_true_lang-CoIoZRiF.js";import{_ as xe}from"./PasswordSendSMS.vue_vue_type_script_setup_true_lang-BGDOr-tn.js";import{_ as ke}from"./PasswordSendEmail.vue_vue_type_script_setup_true_lang-DHh2RbYL.js";import{z as W,n as Le,h as A,b as Se}from"./element-plus-BZE4vQ0t.js";import{l as Pe,a as p,J as M,O as s,u as t,P as y,_ as x,ar as G,V as _,m as c,p as Ae,R as i,B as Q,S as g,a9 as Ce,W as q,X as De}from"./vue-chunks-DM5Q6aJS.js";/* empty css                       *//* empty css                 *//* empty css                   *//* empty css                        *//* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  */import"./useForm-DBy6iRN_.js";/* empty css                          *//* empty css                        *//* empty css                       *//* empty css                *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-7xoOJBR1.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                        *//* empty css                *//* empty css                         */import"./_Uint8Array-DKqHwQen.js";import"./useIcon-CC7FO7rO.js";import"./useValidator-3LOiG8nN.js";import"./role-Bs0HqtDU.js";import"./dept-BoXP6Qyc.js";import"./dict-wI1ILLdR.js";/* empty css                *//* empty css                      */const xt=Pe({name:"AuthUser",__name:"User",setup(m){const{t:r}=ie(),{tableRegister:o,tableState:k,tableMethods:C}=ce({fetchDataApi:()=>v(this,null,function*(){const{pageSize:a,currentPage:e}=k,l=yield ne(E({page:t(e),limit:t(a)},t(V)));return{list:l.data||[],total:l.count||0}}),fetchDelApi:a=>v(this,null,function*(){return(yield ue(a)).code===200}),fetchExportApi:a=>v(this,null,function*(){const{pageSize:e,currentPage:l}=k;return yield de(E({page:t(l),limit:t(e)},t(V)),a)})}),{dataList:U,loading:$,total:L,pageSize:u,currentPage:h}=k,{getList:b,delList:O,getSelections:J,exportQueryList:X}=C,T=p([]);v(this,null,function*(){const e=yield be().getDictObj(["sys_vadmin_gender"]);T.value=e.sys_vadmin_gender});const H=M([{field:"selection",type:"selection",show:!0,disabled:!0},{field:"id",label:"用戶編號",width:"100px",show:!1,disabled:!1},{field:"name",label:"姓名",show:!0,disabled:!0},{field:"nickname",label:"職稱",show:!0},{field:"telephone",label:"帳號",show:!0,disabled:!0},{field:"email",label:"郵箱",show:!0,disabled:!0},{field:"gender",label:"性别",show:!1,slots:{default:a=>{const e=a.row;return s(y,null,[s("div",null,[he(t(T),e.gender)])])}}},{field:"roles",label:"角色",show:!0,slots:{default:a=>{const e=a.row;return s(y,null,[s("div",{class:"text-truncate"},[e.roles.map(l=>l.name).join()])])}}},{field:"depts",label:"部門",show:!0,slots:{default:a=>{const e=a.row;return s(y,null,[s("div",{class:"text-truncate"},[e.depts.map(l=>l.name).join()])])}}},{field:"is_active",label:"是否可用",show:!1,slots:{default:a=>{const e=a.row;return s(y,null,[s(W,{modelValue:e.is_active,disabled:!0},null)])}}},{field:"is_staff",label:"工作人員",show:!0,slots:{default:a=>{const e=a.row;return s(y,null,[s(W,{modelValue:e.is_staff,disabled:!0},null)])}}},{field:"last_login",label:"最近登錄時間",show:!0,width:"190px"},{field:"create_datetime",label:"創建時間",width:"190px",show:!1},{field:"action",width:"150px",label:"操作",show:!0,slots:{default:a=>{const e=a.row,l=["auth.user.update"],d=["auth.user.delete"];return s(y,null,[x(s(w,{type:"primary",link:!0,size:"small",onClick:()=>Y(e)},{default:()=>[_("編輯")]}),[[G("hasPermi"),l]]),x(s(w,{type:"danger",loading:D.value,link:!0,size:"small",onClick:()=>I(e)},{default:()=>[_("刪除")]}),[[G("hasPermi"),d]])])}}}]),K=M([{field:"name",label:"姓名",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}},formItemProps:{labelWidth:"47px"}},{field:"telephone",label:"帳號",component:"Input",componentProps:{clearable:!1,style:{width:"214px"}}},{field:"is_active",label:"狀態",component:"Select",componentProps:{style:{width:"214px"},options:[{label:"正常",value:!0},{label:"停用",value:!1}]}},{field:"is_staff",label:"工作人員",component:"Select",componentProps:{style:{width:"214px"},options:[{label:"是",value:!0},{label:"否",value:!1}]}}]),V=p({}),B=a=>{h.value=1,V.value=a,b()},D=p(!1),I=a=>v(this,null,function*(){D.value=!0,a?yield O(!0,[a.id]).finally(()=>{D.value=!1}):yield O(!0).finally(()=>{D.value=!1})}),f=p(!1),S=p(""),P=p(),n=p(""),j=p(),z=p(!1),Y=a=>v(this,null,function*(){const e=yield re(a.id);e&&(S.value="編輯用戶",e.data.role_ids=e.data.roles.map(l=>l.id),e.data.dept_ids=e.data.depts.map(l=>l.id),n.value="edit",P.value=e.data,f.value=!0)}),Z=()=>{S.value="新增用户",n.value="add",P.value=void 0,f.value=!0},ee=()=>{S.value="批量導入用户",n.value="import",P.value=void 0,f.value=!0},R=p([]),te=()=>v(this,null,function*(){if(R.value=yield J(),R.value.length>0)S.value="重置密碼並發送郵件",n.value="email",P.value=void 0,f.value=!0;else return Se.warning("請先選擇數據")}),ae=()=>v(this,null,function*(){const a=t(j),e=yield a==null?void 0:a.submit();if(e){z.value=!0;try{const l=p({});n.value==="add"?(l.value=yield pe(e),l.value&&(f.value=!1,b())):n.value==="edit"&&(l.value=yield me(e),l.value&&(f.value=!1,b()))}finally{z.value=!1}}});return(a,e)=>{const l=G("hasPermi");return c(),Ae(y,null,[s(t(we),null,{default:i(()=>[s(t(ve),{schema:K,onReset:B,onSearch:B},null,8,["schema"]),s(t(fe),{"current-page":t(h),"onUpdate:currentPage":e[2]||(e[2]=d=>Q(h)?h.value=d:null),"page-size":t(u),"onUpdate:pageSize":e[3]||(e[3]=d=>Q(u)?u.value=d:null),showAction:"",columns:H,"default-expand-all":"","node-key":"id",data:t(U),loading:t($),pagination:{total:t(L)},onRegister:t(o),onRefresh:t(b)},{toolbar:i(()=>[s(t(Le),{gutter:10},{default:i(()=>[x((c(),g(t(A),{span:1.5},{default:i(()=>[s(t(w),{type:"primary",onClick:Z},{default:i(()=>[_("新增用户")]),_:1})]),_:1})),[[l,["auth.user.create"]]]),x((c(),g(t(A),{span:1.5},{default:i(()=>[s(t(w),{onClick:ee},{default:i(()=>[_("批量導入用户")]),_:1})]),_:1})),[[l,["auth.user.import"]]]),x((c(),g(t(A),{span:1.5},{default:i(()=>[s(t(w),{onClick:e[0]||(e[0]=d=>t(X)())},{default:i(()=>[_("導出篩選用户")]),_:1})]),_:1})),[[l,["auth.user.export"]]]),x((c(),g(t(A),{span:1.5},{default:i(()=>[s(t(w),{onClick:te},{default:i(()=>[_("重置密碼通知郵件")]),_:1})]),_:1})),[[l,["auth.user.reset"]]]),x((c(),g(t(A),{span:1.5},{default:i(()=>[s(t(w),{type:"danger",onClick:e[1]||(e[1]=d=>I(null))},{default:i(()=>[_("批量刪除")]),_:1})]),_:1})),[[l,["auth.user.delete"]]])]),_:1})]),_:1},8,["current-page","page-size","columns","data","loading","pagination","onRegister","onRefresh"])]),_:1}),s(t(ge),{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=d=>f.value=d),title:S.value,height:600,width:n.value==="sms"||n.value==="email"?"1000px":"700px"},Ce({default:i(()=>[n.value==="add"||n.value==="edit"?(c(),g(_e,{key:0,ref_key:"writeRef",ref:j,"current-row":P.value},null,8,["current-row"])):n.value==="import"?(c(),g(ye,{key:1,onGetList:t(b)},null,8,["onGetList"])):n.value==="sms"?(c(),g(xe,{key:2,selections:R.value,onGetList:t(b)},null,8,["selections","onGetList"])):n.value==="email"?(c(),g(ke,{key:3,selections:R.value,onGetList:t(b)},null,8,["selections","onGetList"])):De("",!0)]),_:2},[n.value==="add"||n.value==="edit"?{name:"footer",fn:i(()=>[s(t(w),{type:"primary",loading:z.value,onClick:ae},{default:i(()=>[_(q(t(r)("exampleDemo.save")),1)]),_:1},8,["loading"]),s(t(w),{onClick:e[4]||(e[4]=d=>f.value=!1)},{default:i(()=>[_(q(t(r)("dialogDemo.close")),1)]),_:1})]),key:"0"}:void 0]),1032,["modelValue","title","width"])],64)}}});export{xt as default};
