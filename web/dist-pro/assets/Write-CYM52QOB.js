var c=(b,m,a)=>new Promise((f,l)=>{var d=t=>{try{r(a.next(t))}catch(i){l(i)}},v=t=>{try{r(a.throw(t))}catch(i){l(i)}},r=t=>t.done?f(t.value):Promise.resolve(t.value).then(d,v);r((a=a.apply(b,m)).next())});import{u as k,F as C}from"./useForm-DBy6iRN_.js";import{u as A}from"./useValidator-3LOiG8nN.js";import{l as F,aB as x,J as B,O as w,V as D,P as R,a as y,m as V,S as E,R as S,u as _}from"./vue-chunks-DM5Q6aJS.js";import{q}from"./index-ZB82WqWX.js";import{_ as N}from"./ContentWrap.vue_vue_type_script_setup_true_lang-ClFoywJU.js";import{a as O,b as M,p as T,c as $}from"./issue-CMNOJ_uQ.js";import{b as o}from"./element-plus-BZE4vQ0t.js";/* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                  *//* empty css                 *//* empty css               *//* empty css                          *//* empty css                        *//* empty css                       *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                    */import"./style.css_vue_type_style_index_0_src_true_lang-7xoOJBR1.js";import"./wang-editor-kNnY1XhY.js";/* empty css                   *//* empty css                    *//* empty css                */const fe=F({name:"HelpIssueForm",__name:"Write",setup(b,{expose:m}){const{required:a}=A(),{push:f,currentRoute:l}=x(),d={customAlert:(e,s)=>{switch(s){case"success":o.success(e);break;case"info":o.info(e);break;case"warning":o.warning(e);break;case"error":o.error(e);break;default:o.info(e);break}},autoFocus:!1,scroll:!0,readOnly:!1,uploadImgShowBase64:!0,placeholder:"請輸入内容..."},v=B([{field:"title",label:"標題名稱",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"}},formItemProps:{rules:[a()]}},{field:"content",label:"内容",colProps:{span:24},component:"Editor",componentProps:{style:{width:"100%"},editorConfig:d,editorId:"issueContent"},formItemProps:{rules:[a()]}},{field:"category_id",label:"問題類别",colProps:{span:24},component:"Select",componentProps:{style:{width:"100%"}},formItemProps:{rules:[a()]},optionApi:()=>c(this,null,function*(){return(yield O()).data})},{field:"",label:"",colProps:{span:24},formItemProps:{slots:{default:()=>w(R,null,[w(q,{loading:u.value,type:"primary",onClick:I},{default:()=>[D("立即保存")]})])}}}]),{formRegister:r,formMethods:t}=k(),{getFormData:i,getElFormExpose:P,setValues:h}=t,p=y(""),u=y(!1);c(this,null,function*(){const e=l.value.query.id;if(e){p.value="edit";const s=yield $(Number(e));s?h(s.data):f("/404")}else p.value="add"});const I=()=>c(this,null,function*(){const e=yield P();if(yield e==null?void 0:e.validate()){u.value=!0;const g=yield i();if(!g)return u.value=!1,o.error("未獲取到數據");const n=y();try{p.value==="add"?(n.value=yield M(g),n.value&&(e==null||e.resetFields(),o.success("新增成功"))):p.value==="edit"&&(n.value=yield T(g),n.value&&(h(n.value.data),o.success("更新成功")))}finally{u.value=!1}}});return m({submit:I}),(e,s)=>(V(),E(_(N),null,{default:S(()=>[w(_(C),{onRegister:_(r),schema:v,labelPosition:"top"},null,8,["onRegister","schema"])]),_:1}))}});export{fe as default};
