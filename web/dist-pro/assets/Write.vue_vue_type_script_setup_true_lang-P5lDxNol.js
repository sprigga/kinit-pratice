var n=(p,l,t)=>new Promise((i,a)=>{var m=o=>{try{s(t.next(o))}catch(r){a(r)}},c=o=>{try{s(t.throw(o))}catch(r){a(r)}},s=o=>o.done?i(o.value):Promise.resolve(o.value).then(m,c);s((t=t.apply(p,l)).next())});import{u as P,F as y}from"./useForm-8sSQvRCB.js";import{u as h}from"./useValidator-D0Zw1fFG.js";import{u as w}from"./dict-CCE9svEJ.js";import{e as _}from"./task-D5EQHe2Z.js";import{l as Y,J as b,b as D,m as v,S as x,u}from"./vue-chunks-DM5Q6aJS.js";const R=Y({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(p,{expose:l}){const{required:t}=h(),i=p,a=b([{field:"name",label:"任務名稱",component:"Input",colProps:{span:12},componentProps:{style:{width:"100%"}},formItemProps:{rules:[t()]}},{field:"group",label:"任務分組",colProps:{span:12},component:"Select",componentProps:{style:{width:"100%"},allowCreate:!0,filterable:!0,defaultFirstOption:!0,placeholder:"請選擇任務分組，支持直接輸入添加"},optionApi:()=>n(this,null,function*(){return(yield _()).data})},{field:"job_class",label:"調用目標",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:'調用示例：test.main.Test("kinit", 1314)；參數僅支持字串，整數，浮點數，布爾值。'},formItemProps:{rules:[t()]}},{field:"exec_strategy",label:"執行策略",colProps:{span:24},component:"RadioGroup",componentProps:{style:{width:"100%"}},value:"interval",formItemProps:{rules:[t()]},optionApi:()=>n(this,null,function*(){return(yield w().getDictObj(["vadmin_system_task_exec_strategy"])).vadmin_system_task_exec_strategy})},{field:"expression",label:"表達式",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"interval 表達式，五位，分別為：秒 分 時 天 周，例如：10 * * * * 表示每隔 10 秒執行一次任務。"},ifshow:e=>e.exec_strategy==="interval",formItemProps:{rules:[t()]}},{field:"expression",label:"表達式",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:"cron 表達式，六位或七位，分别表示秒、分钟、小時、天、月、星期幾、年(可選)"},ifshow:e=>e.exec_strategy==="cron",formItemProps:{rules:[t()]}},{field:"expression",label:"執行時間",component:"DatePicker",colProps:{span:24},componentProps:{style:{width:"100%"},type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},ifshow:e=>e.exec_strategy==="date",formItemProps:{rules:[t()]}},{field:"start_date",label:"開始時間",colProps:{span:12},component:"DatePicker",componentProps:{style:{width:"100%"},type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},ifshow:e=>e.exec_strategy!=="date"},{field:"end_date",label:"結束時間",colProps:{span:12},component:"DatePicker",componentProps:{style:{width:"100%"},type:"datetime",format:"YYYY-MM-DD HH:mm:ss",valueFormat:"YYYY-MM-DD HH:mm:ss"},ifshow:e=>e.exec_strategy!=="date"},{field:"is_active",label:"任務狀態",colProps:{span:8},component:"RadioGroup",componentProps:{style:{width:"100%"},options:[{label:"正常",value:!0},{label:"停用",value:!1}]},value:!0},{field:"",label:"",colProps:{span:16},component:"Text",value:"創建或更新任務完成後，如果任務狀態與設置的不符，請嘗試刷新數據或查看調度日誌，任務狀態可能會有延遲(幾秒)。"},{field:"remark",label:"備註說明",component:"Input",colProps:{span:24},componentProps:{style:{width:"100%"},maxlength:"1000",showWordLimit:!0,type:"textarea",rows:"3"}}]),{formRegister:m,formMethods:c}=P(),{setValues:s,getFormData:o,getElFormExpose:r}=c,f=()=>n(this,null,function*(){const e=yield r();if(yield e==null?void 0:e.validate())return yield o()});return D(()=>i.currentRow,e=>{e&&s(e)},{deep:!0,immediate:!0}),l({submit:f}),(e,d)=>(v(),x(u(y),{onRegister:u(m),schema:a},null,8,["onRegister","schema"]))}});export{R as _};
