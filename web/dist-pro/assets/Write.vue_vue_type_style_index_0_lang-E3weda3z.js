var P=(d,f,u)=>new Promise((v,p)=>{var g=t=>{try{n(u.next(t))}catch(c){p(c)}},x=t=>{try{n(u.throw(t))}catch(c){p(c)}},n=t=>t.done?v(t.value):Promise.resolve(t.value).then(g,x);n((u=u.apply(d,f)).next())});import{u as j,F as z}from"./useForm-DBy6iRN_.js";import{u as B}from"./useValidator-3LOiG8nN.js";import{I as G}from"./index-ZB82WqWX.js";/* empty css                    *//* empty css                        */import{S as L,b,af as M}from"./element-plus-BZE4vQ0t.js";import{l as N,J as U,O as a,V as r,P as V,a as m,b as q,m as C,p as A,u as w,S as J,X as O}from"./vue-chunks-DM5Q6aJS.js";const $=N({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(d,{expose:f}){const{required:u}=B(),v=d,p=U([{field:"upload_method",label:"上傳方式",colProps:{span:24},component:"RadioGroup",componentProps:{options:[{label:"同時上傳",value:"1"},{label:"按順序上傳",value:"2"}]},value:"1",formItemProps:{rules:[u()]}},{field:"images",label:"",colProps:{span:24},formItemProps:{rules:[u()],slots:{default:()=>a(V,null,[a("div",{class:"flex justify-between w-[100%]"},[a("span",null,[r("圖片資源")]),a("span",null,[r("最大數量限制："),s.value.length,r("/"),i.value])]),a(L,{class:"resource-image-uploader",action:"#","http-request":D,"file-list":s.value,"onUpdate:file-list":e=>s.value=e,"show-file-list":!0,multiple:!0,"before-upload":I,"on-success":_,"on-preview":y,"on-exceed":k,accept:"image/jpeg,image/png",name:"file","list-type":"picture-card",limit:i.value,drag:!0,disabled:i.value<=s.value.length},{default:()=>[s.value.length<i.value?a("div",{class:"resource-image-uploader-icon"},[a(G,{icon:"akar-icons:plus",size:23},null),a("span",{class:"text-[12px]"},[r("點擊或拖拽到這裡")]),a("span",{class:"text-[12px]"},[s.value.length,r("/"),i.value])]):a("div",{class:"resource-image-uploader-icon"},[a("span",{class:"text-[12px]"},[r("已到最大限制")]),a("span",{class:"text-[12px]"},[s.value.length,r("/"),i.value])])]})])}}}]),{formRegister:g,formMethods:x}=j(),{setValues:n,getFormData:t,getElFormExpose:c,setValue:F}=x,h=m(!1),E=m(0),i=m(50),s=m([]),I=e=>{const l=["image/jpeg","image/gif","image/png"].includes(e.type),o=e.size/1024/1024<3;return l||b.error("上傳圖片素材必須是 JPG/PNG/ 格式!"),o||b.error("上傳圖片素材大小不能超過 3MB!"),l&&o},_=(e,l,o)=>{s.value=o,F("images",o)},D=e=>new Promise(l=>{l(e)}),y=e=>{E.value=s.value.findIndex(l=>l.uid===e.uid),h.value=!0},R=()=>{h.value=!1},k=()=>{b.error("上傳失敗，超出圖片最大數量限制!")},S=()=>P(this,null,function*(){const e=yield c();if(yield e==null?void 0:e.validate())return yield t()});return q(()=>v.currentRow,e=>{e&&n(e)},{deep:!0,immediate:!0}),f({submit:S}),(e,l)=>(C(),A(V,null,[a(w(z),{onRegister:w(g),schema:p},null,8,["onRegister","schema"]),h.value?(C(),J(w(M),{key:0,"z-index":9999,onClose:R,"url-list":s.value.map(o=>o.url),"initial-index":E.value},null,8,["url-list","initial-index"])):O("",!0)],64))}});export{$ as _};
